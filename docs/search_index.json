[
["index.html", "Octet and ITC data analysis of Ty1:RBD interaction 1 Octet data analysis and visualization 1.1 Data import 1.2 Initial plot of the titration data as a preview 1.3 Initial pseudo-equilibrium plot to preview the extracted data 1.4 Raw data plots to compare ligands and sensor surfaces 1.5 Analysis and plotting of sensor ligand loads 1.6 Fitting and plotting pseudo-equilibrium data 1.7 Fits of the sensorgrams using 1:1 local fit as implemented in ForteBio software 1.8 Tidying data for evilfit analysis and combined plots of local 1:1 fits vs. global bayesian 1:1 fits (Forte vs. Evilfit) 1.9 Combining the local fits with bayesian analysis in a single plot 1.10 Assembling figures for manuscript 1.11 Looking at expected maximum responses based on ligand/analyte MW ratios 2 Analysis of ITC data 2.1 importing ITC data 2.2 ITC primary plots 2.3 ITC binding isotherms and thermodynamic signatures 2.4 ITC raw data plots 2.5 estimating the error from the two experiments 3 References", " Octet and ITC data analysis of Ty1:RBD interaction [Tim Schulte] Data are associated with our manuscript An alpaca nanobody neutralizes SARS-CoV-2 by blocking receptor interaction led by my colleagues Leo Hanke within the group of Gerry McInerney. The ms was accepted for publication in Nature Communications. The data were also put on DataDryad with doi:10.5061/dryad.gb5mkkwmz. The bookdown document was created based on bookdown, and rtemps. If you find this material useful in your own research or want to re-use some of the code, please cite the main research paper. 1 Octet data analysis and visualization 1.1 Data import Octet data were collected as described in the methods section of the ms. Data were pre-processed and analyzed using the ForteBio software. Raw and processed data were exported and imported into R using the script below. This pipeline was mainly used to tidy the data for plotting and fitting purposes. Final figures as shown in the manuscript were assembled in Adobe Illustrator. library(ggplot2) library(tidyverse) library(plyr) library(tidyr) library(readr) library(readxl) library(knitr) #library(nls) library(nlstools) library(nlshelper) library(minpack.lm) library(broom) library(nls.multstart) library(purrr) #library(gnm) #library(visreg) #library(KRLS) #library(glmnet) #library(glmnetUtils) library(magrittr) library(forcats) library(emmeans) #library(modelr) #library(cowplot) #library(ggridges) #library(ggrepel) #library(ggforce) #library(fitdistrplus) #library(MASS) #library(hexbin) #library(dMod) #library(kimisc) library(ggsci) library(bookdown) library(tinytex) library(kableExtra) library(DT) library(xfun) library(rmatio) library(reshape2) library(latticeExtra) library(viridisLite) library(reticulate) ###from stackoverflow #&#39; @title pr_mutate_when #&#39; @description mutate a column within a dplyr pype only on a subset of rows #&#39; specified by a condition #&#39; Retrieved from a StackOverflow answer (https://stackoverflow.com/a/34170176/6871135) #&#39; @param data a `data.frame` (or `tibble` or `data.table`) #&#39; @param ... expression to be evaluated to filter on rows #&#39; @return `data frame` #&#39; @details DETAILS #&#39; @examples #&#39; \\dontrun{ #&#39; library(magrittr) #&#39; mtcars %&gt;% mutate_when( #&#39; mpg &gt; 22, list(cyl = 100), #&#39; disp == 160, list(cyl = 200)) #&#39; #&#39; } #&#39; @rdname pr_mutate_when #&#39; @export #&#39; @author Kevin Ushey pr_mutate_when &lt;- function(data, ...) { dots &lt;- eval(substitute(alist(...))) for (i in seq(1, length(dots), by = 2)) { condition &lt;- eval(dots[[i]], envir = data) mutations &lt;- eval(dots[[i + 1]], envir = data[condition, , drop = FALSE]) data[condition, names(mutations)] &lt;- mutations } data } ## ### data_overview_tib &lt;- tribble(~rec, ~exprun_digit, ~meas_type, ~meas_driftcorr, ~meas_salt, ~filterme, &quot;BOTH&quot;, 501, &quot;COMP&quot;, &quot;ref&quot;, &quot;norm&quot;, &quot;11&quot;, &quot;nbTy1&quot;, 901, &quot;TIT&quot;, &quot;ref&quot;, &quot;norm&quot;, &quot;11&quot;, &quot;nbTy1&quot;, 1001, &quot;TIT&quot;, &quot;ref&quot;, &quot;high&quot;, &quot;11&quot; ) ### find all relevant files using a filename pattern. data_dir_all &lt;- enframe(list.dirs(path = &quot;./data_octet&quot;, full.names = TRUE, recursive=FALSE)) %&gt;% mutate(filterme = str_detect(value,&quot;RBD&quot;)) %&gt;% subset(filterme == &quot;TRUE&quot;) %&gt;% dplyr::select(-filterme,-name) %&gt;% mutate(dirname=paste(value,&quot;/&quot;,sep=&quot;&quot;)) %&gt;% mutate(fileslist = purrr::map(dirname, ~list.files(path = ., pattern = &quot;*.xls&quot;,recursive = FALSE))) %&gt;% unnest() %&gt;% mutate(sample_temp=str_extract(value,pattern=&quot;[:digit:]{6}xSAXxNBxRBDHisxCOMPx[:digit:]{4}|[:digit:]{6}xSAXxNB1AxRBDHisxTITx[:digit:]{4}&quot;)) %&gt;% mutate(sample=str_extract(sample_temp,pattern=&quot;SAXxNBxRBDHisxCOMPx[:digit:]{4}|[:digit:]{6}xSAXxNB1AxRBDHisxTITx[:digit:]{4}&quot;)) %&gt;% mutate(expnumber = str_extract(sample,pattern=&quot;x[:digit:]{4}&quot;)) %&gt;% mutate(., sample_test = str_extract(sample, &quot;NB1A|NB&quot;)) %&gt;% mutate(., rec = case_when(sample_test == &quot;NB&quot; ~ &quot;BOTH&quot;,sample_test == &quot;NB1A&quot; ~ &quot;nbTy1&quot;, TRUE ~ &quot;STH&quot;)) %&gt;% mutate(., exprun = str_extract(expnumber, pattern = &quot;[:digit:]{4}&quot;)) %&gt;% mutate(., exprun_digit = as.numeric(exprun)) %&gt;% dplyr::select(-sample_temp, -exprun) %&gt;% left_join(., data_overview_tib) # ### filter sensor titration data data_dir_sensors &lt;- data_dir_all %&gt;% mutate(fileslist_filtered = str_detect(fileslist,pattern=&quot;^[:alnum:][:digit:]{1,2}.xls&quot;)) %&gt;% subset(fileslist_filtered == &quot;TRUE&quot;) %&gt;% unite(.,&quot;readme&quot;, c(&quot;dirname&quot;, &quot;fileslist&quot;),sep=&quot;&quot;) %&gt;% dplyr::select(-fileslist_filtered,-value, -expnumber, -sample_test) %&gt;% mutate(sensorid=str_extract(readme,pattern=&quot;[A-H][:digit:]{1,2}.xls&quot;)) %&gt;% mutate(sensorid=str_extract(sensorid,pattern=&quot;[A-H][:digit:]{1,2}&quot;)) %&gt;% mutate(sensor=str_extract(sensorid,pattern=&quot;[A-H]&quot;)) %&gt;% unite(., col = &quot;sampleid&quot;, c(&quot;sample&quot;, &quot;sensorid&quot;), sep = &quot;_&quot;, remove = FALSE) %&gt;% dplyr::select(., readme, sampleid, rec, exprun_digit, meas_type, sensorid, sensor) report_colname_list &lt;- tribble(~report_type, ~repres_colnames, ~repres_range, ~repres_sheet, ~senstray_colnames, ~senstray_range, ~senstray_sheet, &quot;11&quot;, c(&quot;selected&quot;, &quot;include&quot;, &quot;index&quot;, &quot;color&quot;, &quot;sensor_loc&quot;, &quot;sensor_type&quot;, &quot;sensor_info&quot;, &quot;replicate_group&quot;, &quot;baseline_loc&quot;, &quot;assoc_sample&quot;, &quot;sample_id&quot;, &quot;diss_loc&quot;, &quot;load_well&quot;, &quot;load_sample&quot;, &quot;cycle&quot;, &quot;conc&quot;, &quot;response&quot;, &quot;KD_M&quot;, &quot;kon_Ms_inv&quot;,&quot;km_err&quot;,&quot;kdis_s_inv&quot;,&quot;kdir_err&quot;,&quot;Rmax&quot;,&quot;kobs_s_inv&quot;,&quot;kobs_err&quot;,&quot;Req&quot;,&quot;Req_err&quot;,&quot;Req_Rmax_fr&quot;,&quot;ass_X2&quot;,&quot;ass_R2&quot;,&quot;SSG_kd&quot;,&quot;SSG_Rmax&quot;,&quot;SSG_R2&quot;), &quot;A2:AG9&quot;, &quot;Result Table&quot;, c(&quot;step_id&quot;, &quot;step_name&quot;, &quot;step_type&quot;, &quot;step_time&quot;), &quot;A22:D35&quot;, &quot;Sensor Tray&quot;, &quot;21&quot;, c(&quot;selected&quot;, &quot;include&quot;, &quot;index&quot;, &quot;color&quot;, &quot;sensor_loc&quot;, &quot;sensor_type&quot;, &quot;sensor_info&quot;, &quot;replicate_group&quot;, &quot;baseline_loc&quot;, &quot;assoc_sample&quot;, &quot;sample_id&quot;, &quot;diss_loc&quot;, &quot;load_well&quot;, &quot;load_sample&quot;, &quot;cycle&quot;, &quot;conc&quot;, &quot;response&quot;, &quot;KD2_M&quot;, &quot;KD_err&quot;,&quot;KD2_err&quot;,&quot;kon_Ms_inv&quot;,&quot;km&quot;,&quot;kon2&quot;,&quot;kon_err&quot;,&quot;km_err&quot;,&quot;kon2_err&quot;,&quot;kdis_s_inv&quot;,&quot;kdis2&quot;,&quot;kdis_err&quot;,&quot;kdis2_err&quot;,&quot;Rmax&quot;,&quot;Rmax2&quot;,&quot;Rmax2_err&quot;,&quot;kobs_s_inv&quot;, &quot;kobs2&quot;, &quot;kobs_err&quot;, &quot;kobs2_err&quot;, &quot;Req&quot;, &quot;Req2&quot;, &quot;Req_err&quot;, &quot;Req2_err&quot;,&quot;Req_Rmax_fr&quot;, &quot;Req2_Rmax_fr&quot;, &quot;ass_X2&quot;,&quot;ass_R2&quot;,&quot;SSG_kd&quot;,&quot;SSG_Rmax&quot;,&quot;SSG_R2&quot;,&quot;KD_perc&quot;, &quot;KD2_perc&quot;),&quot;A2:AX9&quot;,&quot;Result Table&quot;, c(&quot;step_id&quot;, &quot;step_name&quot;, &quot;step_type&quot;, &quot;step_time&quot;),&quot;A22:D35&quot;, &quot;Sensor Tray&quot;) ### filter sensor parameters (sensors, ligand, concentration): IMPORTANT: modify the results page of the xls report file; and save as tab del file (txt format); then rename to xls data_dir_all_pars &lt;- data_dir_all %&gt;% mutate(fileslist_filtered = str_detect(fileslist,pattern=&quot;^[:alnum:][:digit:]{1,2}.xls&quot;)) %&gt;% dplyr::filter(fileslist_filtered==&quot;FALSE&quot;) %&gt;% mutate(filtername = str_detect(fileslist,&quot;ExcelReport&quot;)) %&gt;% subset(filtername == &quot;TRUE&quot;) %&gt;% dplyr::select(-fileslist_filtered,-filtername) %&gt;% unite(.,&quot;readme&quot;, c(&quot;dirname&quot;, &quot;fileslist&quot;),sep=&quot;&quot;) %&gt;% dplyr::select(-value) %&gt;% dplyr::mutate(., report_name = str_extract(readme, &quot;ExcelReport_kd[:digit:][:digit:]&quot;)) %&gt;% dplyr::mutate(., report_type = str_extract(report_name, &quot;[:digit:][:digit:]&quot;)) %&gt;% left_join(., report_colname_list) %&gt;% mutate(parameters = purrr::pmap(list(readme, repres_sheet, repres_range, repres_colnames), read_xls)) %&gt;% mutate(senstray = purrr::pmap(list(readme, senstray_sheet, senstray_range, senstray_colnames), read_xls)) %&gt;% mutate(parameters_sel = purrr::map(parameters, ~dplyr::select(.,sensorid=sensor_loc,ligand = sample_id, conc_nM = conc))) data_dir_all_selpars &lt;- data_dir_all_pars %&gt;% dplyr::filter(., report_type == filterme) %&gt;% dplyr::select(sample, parameters_sel, contains(&quot;meas&quot;)) %&gt;% unnest(., cols = c(&quot;parameters_sel&quot;)) %&gt;% unite(., col = &quot;sampleid&quot;, c(&quot;sample&quot;, &quot;sensorid&quot;), sep = &quot;_&quot;, remove = FALSE) data_dir_all_sensors_pars &lt;- data_dir_sensors %&gt;% group_by(., sampleid, readme, rec, exprun_digit, meas_type, sensorid, sensor) %&gt;% dplyr::summarize() %&gt;% right_join(., data_dir_all_selpars) data_dir_all_pars_mod &lt;- data_dir_all_pars %&gt;% mutate(., senstray_acc = purrr::map(senstray, ~dplyr::mutate(., step_time_acc = purrr::map_dbl(seq_along(step_time), ~sum(step_time[1:.x])) ))) ###combine parameters with sensor data data_dir_all_csv &lt;- data_dir_all_sensors_pars %&gt;% drop_na(., readme) %&gt;% mutate(csv = purrr::map(readme,~read_tsv(.,skip=5, col_names = c(&quot;time&quot;,&quot;octet&quot;,&quot;simulated&quot;))) ) data_dir_all_csv_titrations &lt;- data_dir_all_csv %&gt;% ungroup() %&gt;% dplyr::select(-readme) %&gt;% mutate(csv_shifted = purrr::map(csv,~dplyr::mutate(.,time_shifted = time - min(time)))) %&gt;% dplyr::select(-csv) 1.2 Initial plot of the titration data as a preview data_dir_all_csv_titrations_forteplot &lt;- data_dir_all_csv_titrations %&gt;% dplyr::filter(meas_type == &quot;TIT&quot;) %&gt;% unnest(., cols = c(&quot;csv_shifted&quot;)) %&gt;% ggplot(data=., aes(x=time_shifted, y=octet, colour=conc_nM, group = sampleid)) + #ylab(&quot;Abs /mAU&quot;) +#xlim(c(0,1000)) +#ylim(c(-5,50)) + #geom_vline(xintercept = mwlines, color = &quot;red&quot;, linetype=&quot;dashed&quot;, size=0.5) + #geom_point(size = 2, stroke = 0.1, alpha=0.2, colour = &quot;black&quot;) + geom_line(size=0.5) + scale_x_continuous(&quot;time: s&quot;, breaks = c(0, 900, 1800, 2700, 3600, 4300)) + scale_y_continuous(&quot;octet: nm&quot;) + scale_colour_gradient2(low=&quot;green&quot;, mid = &quot;blue&quot;, high=&quot;red&quot;, midpoint = 10 ,space =&quot;Lab&quot;, trans = &quot;log2&quot;) + #, facet_grid(exprun_digit ~ ., scales = &quot;free_y&quot;) + #facet_grid_paginate(index ~ rec, ncol=2, nrow=4, page = i) + theme_light() print(data_dir_all_csv_titrations_forteplot) #ggsave(file=&quot;ggplot_ligand_ligand_temp.jpeg&quot;, plot=data_dir_all_csv_titrations_plot,device=&quot;jpeg&quot;) ggsave(file=&quot;./ggplot_ligand_ligand_forte.jpeg&quot;, device=&quot;jpeg&quot;, width = 120, height = 120, units = c(&quot;mm&quot;)) #ggsave(file=&quot;./ggplot_ligand_ligand.ps&quot;, width = 120, height = 110, units = c(&quot;mm&quot;)) Initial plot of the two titrations at low (experiment 901) and high (experiment 1001) salt concentrations, respectively. 1.3 Initial pseudo-equilibrium plot to preview the extracted data Pseudo-equilibrium octet values were first extraced … data_pall_csv_conc_titrations_eq &lt;- data_dir_all_csv_titrations %&gt;% mutate(csv_shifted_eqphase = purrr::map(csv_shifted, ~filter(.,time_shifted &gt; 1750 &amp; time_shifted &lt; 1800))) %&gt;% mutate(csv_shifted_eqvalue = purrr::map(csv_shifted_eqphase, ~summarize(.,octet_eq = mean(octet)))) %&gt;% unnest(., c(&quot;csv_shifted_eqvalue&quot;)) data_pall_csv_conc_titrations_eq_leftjoin &lt;- data_pall_csv_conc_titrations_eq %&gt;% dplyr::select(., sampleid, conc_nM, octet_eq) data_dir_all_csv_titrations_unnested &lt;- data_dir_all_csv_titrations %&gt;% left_join(., data_pall_csv_conc_titrations_eq_leftjoin) %&gt;% unnest(cols = c(&quot;csv_shifted&quot;)) %&gt;% group_by(., rec, meas_type) %&gt;% group_modify(., ~mutate(.,index=group_indices(.,exprun_digit))) %&gt;% ungroup() ### plot eq values against concentration: 1200s association data_dir_all_csv_titrations_all_nested &lt;- data_dir_all_csv_titrations_unnested %&gt;% dplyr::filter(.,meas_type == &quot;TIT&quot;) %&gt;% group_by(., rec, meas_type, sampleid, exprun_digit, sensorid, sensor, sample, ligand, conc_nM, octet_eq, index) %&gt;% nest(.) data_pall_csv_conc_titrations_ligand_eq &lt;- data_pall_csv_conc_titrations_eq %&gt;% dplyr::filter(meas_type == &quot;TIT&quot;) and then plotted against the RBD concentration. data_pall_csv_conc_titrations_ligand_eq_logplot &lt;- data_pall_csv_conc_titrations_ligand_eq %&gt;% ggplot(data=., aes(x=conc_nM, y=octet_eq, color=conc_nM, group=factor(sampleid))) + #xlab(&quot;Vol /mL&quot;) + #ylab(&quot;Abs /mAU&quot;) +#xlim(c(0,1000)) +#ylim(c(-5,50)) + #geom_vline(xintercept = mwlines, color = &quot;red&quot;, linetype=&quot;dashed&quot;, size=0.5) + geom_point(size=2) + scale_x_log10(&quot;c(RBD): nM&quot;) + scale_y_continuous(&quot;pseudo-eq octet: nm&quot;) + scale_color_gradient2(&quot;c(RBD): nM&quot;, low=&quot;green&quot;, mid=&quot;blue&quot;, high=&quot;red&quot;, space =&quot;Lab&quot;,midpoint=3, trans = &quot;log2&quot;) + #, facet_grid(sample ~ ., scales = &quot;free_y&quot;) + theme_light() print(data_pall_csv_conc_titrations_ligand_eq_logplot) ggsave(file=&quot;ggplot_ligand_titrations_eqconc_log.jpeg&quot;, plot=data_pall_csv_conc_titrations_ligand_eq_logplot,device=&quot;jpeg&quot;) #ggsave(file=&quot;ggplot_ligand_titrations_eqconc_log.ps&quot;, plot=data_pall_csv_conc_titrations_ligand_eq_logplot,device=&quot;ps&quot;) Pseudo-equilibrium data versus ligand concentration on semi-log scale, without any fits. 1.4 Raw data plots to compare ligands and sensor surfaces Before continuing with data fitting and further analysis, raw data are plotted in panels for all experiments. Plots saved as JPGs, only shown for the comparative experiment, not for the titrations. ### filter sensor titration data data_dir_sensors_raw &lt;- data_dir_all %&gt;% dplyr::filter(., fileslist == &quot;RawData0.xls&quot;) %&gt;% unite(.,&quot;readme&quot;, c(&quot;dirname&quot;, &quot;fileslist&quot;),sep=&quot;&quot;) %&gt;% dplyr::select(-expnumber) sensor_spec &lt;- tribble(~.name, ~.value, ~sensor, ~ligand, ~analyte, ~meas_type, ~meas_driftcorr, &quot;A_time&quot;, &quot;time&quot;, &quot;A&quot;, &quot;nbTy1&quot;, &quot;RBD&quot;, &quot;TIT&quot;, &quot;none&quot;, &quot;A_octet&quot;, &quot;octet&quot;, &quot;A&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;none&quot;, &quot;B_time&quot;, &quot;time&quot;, &quot;B&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;TIT&quot;, &quot;none&quot;, &quot;B_octet&quot;, &quot;octet&quot;, &quot;B&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;none&quot;, &quot;C_time&quot;, &quot;time&quot;, &quot;C&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;TIT&quot;, &quot;none&quot;, &quot;C_octet&quot;, &quot;octet&quot;, &quot;C&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;none&quot;, &quot;D_time&quot;, &quot;time&quot;, &quot;D&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;TIT&quot;, &quot;none&quot;, &quot;D_octet&quot;, &quot;octet&quot;, &quot;D&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;none&quot;, &quot;E_time&quot;, &quot;time&quot;, &quot;E&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;TIT&quot;, &quot;none&quot;, &quot;E_octet&quot;, &quot;octet&quot;, &quot;E&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;none&quot;, &quot;F_time&quot;, &quot;time&quot;, &quot;F&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;TIT&quot;, &quot;none&quot;, &quot;F_octet&quot;, &quot;octet&quot;, &quot;F&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;none&quot;, &quot;G_time&quot;, &quot;time&quot;, &quot;G&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;TIT&quot;, &quot;none&quot;, &quot;G_octet&quot;, &quot;octet&quot;, &quot;G&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;none&quot;, &quot;H_time&quot;, &quot;time&quot;, &quot;H&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;TIT&quot;, &quot;none&quot;, &quot;H_octet&quot;, &quot;octet&quot;, &quot;H&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;none&quot;, &quot;A_time&quot;, &quot;time&quot;, &quot;A&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;TIT&quot;, &quot;ref&quot;, &quot;A_octet&quot;, &quot;octet&quot;, &quot;A&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;ref&quot;, &quot;B_time&quot;, &quot;time&quot;, &quot;B&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;TIT&quot;, &quot;ref&quot;, &quot;B_octet&quot;, &quot;octet&quot;, &quot;B&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;ref&quot;, &quot;C_time&quot;, &quot;time&quot;, &quot;C&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;TIT&quot;, &quot;ref&quot;, &quot;C_octet&quot;, &quot;octet&quot;, &quot;C&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;ref&quot;, &quot;D_time&quot;, &quot;time&quot;, &quot;D&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;TIT&quot;, &quot;ref&quot;, &quot;D_octet&quot;, &quot;octet&quot;, &quot;D&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;ref&quot;, &quot;E_time&quot;, &quot;time&quot;, &quot;E&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;TIT&quot;, &quot;ref&quot;, &quot;E_octet&quot;, &quot;octet&quot;, &quot;E&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;ref&quot;, &quot;F_time&quot;, &quot;time&quot;, &quot;F&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;TIT&quot;, &quot;ref&quot;, &quot;F_octet&quot;, &quot;octet&quot;, &quot;F&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;ref&quot;, &quot;G_time&quot;, &quot;time&quot;, &quot;G&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;TIT&quot;, &quot;ref&quot;, &quot;G_octet&quot;, &quot;octet&quot;, &quot;G&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;TIT&quot;, &quot;ref&quot;, &quot;H_time&quot;, &quot;time&quot;, &quot;H&quot;, &quot;nbTy1&quot;,&quot;PBST&quot;,&quot;TIT&quot;, &quot;ref&quot;, &quot;H_octet&quot;, &quot;octet&quot;, &quot;H&quot;,&quot;nbTy1&quot;,&quot;PBST&quot;, &quot;TIT&quot;, &quot;ref&quot;, &quot;A_time&quot;, &quot;time&quot;, &quot;A&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;COMP&quot;, &quot;ref&quot;, &quot;A_octet&quot;, &quot;octet&quot;, &quot;A&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;COMP&quot;, &quot;ref&quot;, &quot;B_time&quot;, &quot;time&quot;, &quot;B&quot;, &quot;nbTy1&quot;,&quot;RBD&quot;,&quot;COMP&quot;, &quot;ref&quot;, &quot;B_octet&quot;, &quot;octet&quot;, &quot;B&quot;,&quot;nbTy1&quot;,&quot;RBD&quot;, &quot;COMP&quot;, &quot;ref&quot;, &quot;C_time&quot;, &quot;time&quot;, &quot;C&quot;, &quot;nbTy1&quot;,&quot;PBST&quot;,&quot;COMP&quot;, &quot;ref&quot;, &quot;C_octet&quot;, &quot;octet&quot;, &quot;C&quot;, &quot;nbTy1&quot;,&quot;PBST&quot;,&quot;COMP&quot;, &quot;ref&quot;, &quot;D_time&quot;, &quot;time&quot;, &quot;D&quot;, &quot;SAX&quot;,&quot;RBD&quot;,&quot;COMP&quot;, &quot;ref&quot;, &quot;D_octet&quot;, &quot;octet&quot;, &quot;D&quot;, &quot;SAX&quot;,&quot;RBD&quot;,&quot;COMP&quot;, &quot;ref&quot;, &quot;E_time&quot;, &quot;time&quot;, &quot;E&quot;,&quot;NP-VHH1&quot;,&quot;RBD&quot;,&quot;COMP&quot;, &quot;ref&quot;, &quot;E_octet&quot;, &quot;octet&quot;, &quot;E&quot;, &quot;NP-VHH1&quot;,&quot;RBD&quot;,&quot;COMP&quot;, &quot;ref&quot;, &quot;F_time&quot;, &quot;time&quot;, &quot;F&quot;, &quot;NP-VHH1&quot;,&quot;RBD&quot;,&quot;COMP&quot;, &quot;ref&quot;, &quot;F_octet&quot;, &quot;octet&quot;, &quot;F&quot;, &quot;NP-VHH1&quot;,&quot;RBD&quot;,&quot;COMP&quot;, &quot;ref&quot;, &quot;G_time&quot;, &quot;time&quot;, &quot;G&quot;, &quot;NP-VHH1&quot;,&quot;PBST&quot;,&quot;COMP&quot;, &quot;ref&quot;, &quot;G_octet&quot;, &quot;octet&quot;, &quot;G&quot;, &quot;NP-VHH1&quot;,&quot;PBST&quot;,&quot;COMP&quot;, &quot;ref&quot;, &quot;H_time&quot;, &quot;time&quot;, &quot;H&quot;, &quot;SAX&quot;,&quot;RBD&quot;,&quot;COMP&quot;, &quot;ref&quot;, &quot;H_octet&quot;, &quot;octet&quot;, &quot;H&quot;, &quot;SAX&quot;,&quot;RBD&quot;,&quot;COMP&quot;, &quot;ref&quot;) sensor_spec_nested &lt;- sensor_spec %&gt;% group_by(., meas_type, meas_driftcorr) %&gt;% nest() %&gt;% dplyr::select(., meas_type, meas_driftcorr, sensor_par = data) sensor_plot_f &lt;- function(df){ plot_obj &lt;- ggplot(data=df, aes(x=time, y=octet, color=sensor)) + #xlab(&quot;Vol /mL&quot;) + #ylab(&quot;Abs /mAU&quot;) +#xlim(c(0,1000)) +#ylim(c(-5,50)) + #geom_vline(xintercept = mwlines, color = &quot;red&quot;, linetype=&quot;dashed&quot;, size=0.5) + geom_line(size=1) + scale_x_continuous(&quot;time: s&quot;) + scale_y_continuous(&quot;octet: nm&quot;) + theme_light() + scale_color_aaas() + #scale_color_gradient2(low=&quot;green&quot;, mid=&quot;blue&quot;, high=&quot;red&quot;, space =&quot;Lab&quot;,midpoint=3, trans = &quot;log10&quot;) + #, facet_grid(ligand ~ analyte) return(plot_obj) } ### plot raw data data_dir_sensors_raw_xls &lt;- data_dir_sensors_raw %&gt;% mutate(csv = purrr::map(readme,~read_tsv(., skip = 1, col_names = c(&quot;A_time&quot;, &quot;A_octet&quot;, &quot;B_time&quot;, &quot;B_octet&quot;, &quot;C_time&quot;, &quot;C_octet&quot;, &quot;D_time&quot;, &quot;D_octet&quot;, &quot;E_time&quot;, &quot;E_octet&quot;, &quot;F_time&quot;, &quot;F_octet&quot;, &quot;G_time&quot;, &quot;G_octet&quot;,&quot;H_time&quot;, &quot;H_octet&quot;))) ) %&gt;% left_join(., sensor_spec_nested) data_dir_sensors_raw_xls_longer &lt;- data_dir_sensors_raw_xls %&gt;% mutate(xls_longer = purrr::pmap(list(csv, sensor_par), pivot_longer_spec)) %&gt;% mutate(xls_longer_sorted = purrr::map(xls_longer,~arrange(., sensor))) %&gt;% dplyr::mutate(., sensor_plot = purrr::pmap(list(xls_longer_sorted),sensor_plot_f)) %&gt;% dplyr::mutate(., plot_name = paste(&quot;rawdata_&quot;, sample, &quot;.jpeg&quot;, sep =&quot;&quot;)) pwalk(list(data_dir_sensors_raw_xls_longer$plot_name, data_dir_sensors_raw_xls_longer$sensor_plot), ggsave) data_dir_sensors_raw_xls_longer_comp &lt;- data_dir_sensors_raw_xls_longer %&gt;% dplyr::select(., c(1:10), xls_longer_sorted) %&gt;% dplyr::filter(., rec == &quot;BOTH&quot;) %&gt;% unnest(., xls_longer_sorted) %&gt;% dplyr::mutate(., plotgroup = paste(ligand, analyte, sep = &quot; &amp; &quot;)) sample_list_colororder &lt;- data_dir_sensors_raw_xls_longer_comp %&gt;% group_by(., exprun_digit, sample, sensor, ligand, analyte, plotgroup) %&gt;% dplyr::summarize(., min_time = min(time)) %&gt;% dplyr::mutate(., plotid = paste(sample, sensor, sep = &quot;x&quot;)) %&gt;% ungroup() data_dir_sensors_raw_xls_longer_comp_plot &lt;- data_dir_sensors_raw_xls_longer_comp %&gt;% ggplot(., aes(x=time, y=octet, color=plotgroup)) + #xlab(&quot;Vol /mL&quot;) + #ylab(&quot;Abs /mAU&quot;) +#xlim(c(0,1000)) +#ylim(c(-5,50)) + #geom_vline(xintercept = mwlines, color = &quot;red&quot;, linetype=&quot;dashed&quot;, size=0.5) + geom_line(size=1) + scale_x_continuous(&quot;time: s&quot;, n.breaks = 10) + scale_y_continuous(&quot;octet: nm&quot;) + theme_light() + scale_color_aaas() #scale_color_gradient2(low=&quot;green&quot;, mid=&quot;blue&quot;, high=&quot;red&quot;, space =&quot;Lab&quot;,midpoint=3, trans = &quot;log10&quot;) + #, #facet_grid(. ~ .) print(data_dir_sensors_raw_xls_longer_comp_plot) ggsave(&quot;comparative_plot.jpeg&quot;, plot = data_dir_sensors_raw_xls_longer_comp_plot, width = 160, height = 80, units = c(&quot;mm&quot;)) ggsave(&quot;comparative_plot.ps&quot;, plot = data_dir_sensors_raw_xls_longer_comp_plot, width = 160, height = 80, units = c(&quot;mm&quot;)) This figure was used in an earlier manuscript version, following caption just copied froma that earlier version: RBD bounds to surface-immobilized nbTy1 (red curves), but not to NP-VH11 (violet curves) or to biocytin-quenched Streptavidin (SAX, green curves). Almost equal nanobody immobilization levels of about 0.7 nm were obtained by first loading nbTy1 and then NP-VH11. The SAX control surface (green) was only quenched, but not loaded with nanobodies. During association, nanobody sample and control SAX sensors (red, violet and green) were dipped into RBD, while the reference nanobody sensors were dipped into PBST (blue and light-green). For dissociation, all sensors were dipped into PBST. Binding of molecules over time is recorded as sensorgrams recording the shift in wavelengths (unit: nm) due to an increase in the optical thickness of the surface layer. sample_list_colororder_add &lt;- sample_list_colororder data_dir_all_csv_comp_forteplot &lt;- data_dir_all_csv_titrations %&gt;% dplyr::filter(meas_type == &quot;COMP&quot;) %&gt;% dplyr::mutate(., nanobody = case_when(sensorid == &quot;A5&quot; ~ &quot;nbTy1&quot;, sensorid == &quot;B5&quot; ~&quot;nbTy1&quot;, sensorid == &quot;E5&quot; ~&quot;NP-VHH1&quot;, sensorid == &quot;F5&quot; ~&quot;NP-VHH1&quot;) ) %&gt;% dplyr::mutate(., plotgroup = paste(nanobody, &quot; &amp; RBD&quot;, sep = &quot;&quot;)) %&gt;% dplyr::mutate(., sensor = str_extract(sensorid, pattern = &quot;[ABCDEFGH]&quot;)) %&gt;% dplyr::mutate(., plotid = paste(sample, sensor, sep = &quot;x&quot;)) %&gt;% dplyr::mutate(., plotorder = case_when(nanobody == &quot;nbTy1&quot; ~ &quot;id2:nbTy1&quot;, nanobody == &quot;NP-VHH1&quot; ~ &quot;id1:NP-VHH1&quot;, TRUE ~ &quot;none&quot;)) %&gt;% unnest(., cols = c(&quot;csv_shifted&quot;)) %&gt;% ggplot(data=., aes(x=time_shifted, y=octet, colour=plotorder, group = plotid)) + #ylab(&quot;Abs /mAU&quot;) +#xlim(c(0,1000)) +#ylim(c(-5,50)) + #geom_vline(xintercept = mwlines, color = &quot;red&quot;, linetype=&quot;dashed&quot;, size=0.5) + #geom_point(size = 2, stroke = 0.1, alpha=0.2, colour = &quot;black&quot;) + geom_line(size=0.5) + scale_x_continuous(&quot;time: min&quot;, breaks = c(0, 900, 1800, 2700, 3600), labels = function(breaks) breaks/60) + scale_y_continuous(&quot;octet: nm&quot;, limits = c(-0.1,2)) + #scale_colour_gradient2(low=&quot;green&quot;, mid = &quot;blue&quot;, high=&quot;red&quot;, midpoint = 10 ,space =&quot;Lab&quot;, trans = &quot;log2&quot;) + #, #facet_grid(exprun_digit ~ .) + scale_color_aaas() + #facet_grid_paginate(index ~ rec, ncol=2, nrow=4, page = i) + theme_light() print(data_dir_all_csv_comp_forteplot) #ggsave(file=&quot;ggplot_ligand_ligand_temp.jpeg&quot;, plot=data_dir_all_csv_titrations_plot,device=&quot;jpeg&quot;) ggsave(file=&quot;./ggplot_ligand_ligand_fortecomp.jpeg&quot;, device=&quot;jpeg&quot;, width = 120, height = 40, units = c(&quot;mm&quot;)) #ggsave(file=&quot;./ggplot_ligand_ligand.ps&quot;, width = 120, height = 110, units = c(&quot;mm&quot;)) Plot used for Figure 3A in ms. see figure legend in ms for more details. 1.5 Analysis and plotting of sensor ligand loads #define report points for sensor loads data_dir_all_pars_mod_sample_loadids &lt;- data_dir_all_pars_mod %&gt;% dplyr::select(sample, meas_type) %&gt;% group_by(sample, meas_type) %&gt;% dplyr::summarize() %&gt;% dplyr::mutate(., load_id1 = case_when(meas_type == &quot;TIT&quot; ~ 1, meas_type == &quot;COMP&quot; ~ 1, TRUE ~ 0), load_id2 = case_when(meas_type == &quot;TIT&quot; ~ 4, meas_type == &quot;COMP&quot; ~ 3, TRUE ~ 0), load_id3 = case_when(meas_type == &quot;TIT&quot; ~ 1, meas_type == &quot;COMP&quot; ~ 3, TRUE ~ 0), load_id4 = case_when(meas_type == &quot;TIT&quot; ~ 4, meas_type == &quot;COMP&quot; ~ 6, TRUE ~ 0)) pull_id_times_f &lt;- function(senstray_acc, load_id){ time &lt;- senstray_acc %&gt;% dplyr::filter(., step_id == load_id) %&gt;% dplyr::select(., step_time_acc) %&gt;% pull() return(time) } data_dir_all_pars_mod_join &lt;- data_dir_all_pars_mod %&gt;% dplyr::filter(., filterme == report_type) %&gt;% dplyr::select(., sample, meas_type, senstray_acc) %&gt;% left_join(., data_dir_all_pars_mod_sample_loadids) %&gt;% dplyr::mutate(., id1_time = purrr::pmap(list(senstray_acc, load_id1), pull_id_times_f),id2_time = purrr::pmap(list(senstray_acc, load_id2), pull_id_times_f), id3_time = purrr::pmap(list(senstray_acc, load_id3), pull_id_times_f), id4_time = purrr::pmap(list(senstray_acc, load_id4), pull_id_times_f) ) %&gt;% unchop(., cols = c(&quot;id1_time&quot;, &quot;id2_time&quot;, &quot;id3_time&quot;, &quot;id4_time&quot;)) %&gt;% dplyr::select(., sample, meas_type, contains(&quot;_time&quot;)) #extract sensorloads at the defined timepoints sensor_load_pull_f &lt;- function(df, id_time){ df_value &lt;- df %&gt;% dplyr::filter(., time &gt; (id_time-5) &amp; time &lt; (id_time+0.1)) %&gt;% dplyr::group_by(., sensor) %&gt;% dplyr::summarize(., octet_level = mean(octet)) return(df_value) } data_dir_sensors_raw_xls_longer_sensorloads &lt;- data_dir_sensors_raw_xls_longer %&gt;% dplyr::select(., -csv, -sensor_par, -sensor_plot, -plot_name, -xls_longer) %&gt;% left_join(., data_dir_all_pars_mod_join) %&gt;% dplyr::mutate(level_id1 = purrr::pmap(list(xls_longer_sorted, id1_time), sensor_load_pull_f),level_id2 = purrr::pmap(list(xls_longer_sorted, id2_time), sensor_load_pull_f),level_id3 = purrr::pmap(list(xls_longer_sorted, id3_time), sensor_load_pull_f), level_id4 = purrr::pmap(list(xls_longer_sorted, id4_time), sensor_load_pull_f)) combine_level_ids_f &lt;- function(df1, df2, df3, df4){ df_combined &lt;- df1 %&gt;% left_join(., df2) %&gt;% left_join(., df3) %&gt;% left_join(., df4) return(df_combined) } data_dir_sensors_raw_xls_longer_sensorloads_unnested &lt;- data_dir_sensors_raw_xls_longer_sensorloads %&gt;% dplyr::select(sample, rec, exprun_digit, meas_type, meas_driftcorr, meas_salt, contains(&quot;level&quot;)) %&gt;% dplyr::mutate(level_id1_rn = purrr::map(level_id1, ~dplyr::select(., sensor, level_id1 = octet_level)), level_id2_rn = purrr::map(level_id2, ~dplyr::select(., sensor, level_id2 = octet_level)), level_id3_rn = purrr::map(level_id3, ~dplyr::select(., sensor, level_id3 = octet_level)), level_id4_rn = purrr::map(level_id4, ~dplyr::select(., sensor, level_id4 = octet_level)) ) %&gt;% dplyr::select(., -c(&quot;level_id1&quot;,&quot;level_id2&quot;,&quot;level_id3&quot;,&quot;level_id4&quot;)) %&gt;% dplyr::mutate(level_ids = purrr::pmap(list(level_id1_rn, level_id2_rn, level_id3_rn, level_id4_rn), combine_level_ids_f)) %&gt;% dplyr::mutate(level_ids_diff = purrr::map(level_ids, ~dplyr::mutate(., diff_id1 = level_id2 - level_id1, diff_id3 = level_id4 - level_id3) )) %&gt;% dplyr::select(., sample, rec, exprun_digit, meas_type, contains(&quot;meas_&quot;), level_ids_diff) %&gt;% unnest(., c(&quot;level_ids_diff&quot;)) %&gt;% dplyr::mutate(., plotname = &quot;sensors&quot;) data_dir_sensorloads_sel_plot &lt;- data_dir_sensors_raw_xls_longer_sensorloads_unnested %&gt;% dplyr::filter(meas_type == &quot;TIT&quot; &amp; exprun_digit &gt; 802) %&gt;% ggplot(., aes(x = plotname, y = diff_id1)) + geom_boxplot(position = &quot;identity&quot;, outlier.shape = NA) + geom_jitter(stat = &quot;identity&quot;, width = 0.1) + facet_grid(exprun_digit ~ ., scales = &quot;free_y&quot;) + scale_color_aaas() + scale_y_continuous(name = NULL, limits = c(0, 0.5)) + theme_light() print(data_dir_sensorloads_sel_plot) ggsave(&quot;./sensorload_all_sel.jpeg&quot;, data_dir_sensorloads_sel_plot, device=&quot;jpeg&quot;, width = 40, height = 80, units = c(&quot;mm&quot;)) Sensor Loads of titration experiments. Used for Figures 3B and supplemental Figure 2A. see figure legend in ms for more details. sensor_spec_nested_comp &lt;- sensor_spec_nested %&gt;% dplyr::filter(., meas_type == &quot;COMP&quot;) %&gt;% unnest(sensor_par) %&gt;% group_by(., meas_type, meas_driftcorr, sensor, ligand, analyte) %&gt;% dplyr::summarize() %&gt;% ungroup() %&gt;% dplyr::select(sensor, ligand, analyte) data_dir_sensors_raw_xls_longer_sensorloads_unnested_comp &lt;- data_dir_sensors_raw_xls_longer_sensorloads_unnested %&gt;% dplyr::filter(., meas_type == &quot;COMP&quot;) %&gt;% dplyr::select(., c(sample, rec, exprun_digit, sensor, diff_id1, diff_id3)) %&gt;% left_join(., sensor_spec_nested_comp) %&gt;% dplyr::mutate(., sensorgroup = case_when(sensor == &quot;A&quot; ~ &quot;AD&quot;, sensor == &quot;B&quot; ~ &quot;AD&quot;, sensor == &quot;C&quot; ~ &quot;AD&quot;, sensor == &quot;D&quot; ~ &quot;AD&quot;,sensor == &quot;E&quot; ~ &quot;EH&quot;, sensor == &quot;F&quot; ~ &quot;EH&quot;, sensor == &quot;G&quot; ~ &quot;EH&quot;, sensor == &quot;H&quot; ~ &quot;EH&quot;)) %&gt;% dplyr::mutate(., diff_id = case_when(sensorgroup == &quot;AD&quot; ~ diff_id1, sensorgroup == &quot;EH&quot; ~ diff_id3, TRUE ~ 0)) data_dir_sensorloads_comp_plot &lt;- data_dir_sensors_raw_xls_longer_sensorloads_unnested_comp %&gt;% dplyr::mutate(., plotorder = case_when(ligand == &quot;nbTy1&quot; ~ &quot;id2:nbTy1&quot;, ligand == &quot;NP-VHH1&quot; ~ &quot;id1:NP-VHH1&quot;, ligand == &quot;SAX&quot; ~ &quot;id3: SAX&quot;, TRUE ~ &quot;none&quot;)) %&gt;% dplyr::filter(., ligand != &quot;SAX&quot;) %&gt;% ggplot(., aes(x = ligand, y = diff_id)) + geom_boxplot(position = &quot;identity&quot;, outlier.shape = NA) + geom_jitter(aes(colour = plotorder), stat = &quot;identity&quot;, width = 0.1) + facet_grid(. ~ ., scales = &quot;free_y&quot;) + scale_color_aaas() + scale_x_discrete() + scale_y_continuous(name = NULL, labels = NULL, limits = c(-0.1,2)) + theme_light() print(data_dir_sensorloads_comp_plot) ggsave(&quot;./sensorload_all_comp.jpeg&quot;, data_dir_sensorloads_comp_plot, device=&quot;jpeg&quot;, width = 60, height = 120, units = c(&quot;mm&quot;)) Sensor Loads of comparative experiments. Used for Figure 3A. see ms figure legend in ms for more details. 1.6 Fitting and plotting pseudo-equilibrium data Pseudo-eq binding data were fit using the Hill equation, taken from (Gadagkar and Call 2015): \\[\\begin{equation} octet_{eq} = octet_0 + \\frac{octet_{max} - octet_0}{1+[\\frac{EC50}{conc}]^{hslope} } \\tag{1.1} \\end{equation}\\] and a simple Langmuir isotherm, eq taken from (O’Shannessy and Winzor 1996) \\[\\begin{equation} octet_{eq} = \\frac{octet_{max}*conc}{Kd + conc} \\tag{1.2} \\end{equation}\\] with \\(octet_{eq}\\) as pseude-equilibrium values, \\(octet_0\\) as response at zero analyte concentration, \\(EC50\\) and \\(Kd\\) as half-maximum response and affinity, respectively, \\(conc\\) as analyte concentration, and \\(hslope\\) as the hill slope. Data fitting chunk: # Hill-fit https://doi.org/10.1016/j.vascn.2014.08.006 # Myszka (1996) Analytical BIochemistry: Equilibrium Analysis of High Affinity Interactions Using BIACORE # O’Shannessy, D J, and D J Winzor. 1996. “Interpretation of Deviations from Pseudo-First-Order Kinetic Behavior in the Characterization of Ligand Binding by Biosensor Technology.” Analytical Biochemistry 236 (2): 275–83. https://doi.org/10.1006/abio.1996.0167. norm_purrr_f &lt;- function(df){ octet_max &lt;- 0.7 #max(octet_eq) df_norm &lt;- df %&gt;% mutate(., octet_norm = ((octet_eq-min(octet_eq))/(octet_max-min(octet_eq))), conc_nM_dimer = conc_nM/2) return(df_norm) } nlsLM_KD_f &lt;- function(data, Rstart, Rminlim, Rmaxlim){ fit_obj &lt;- nlsLM(octet_eq ~ (R*conc_nM/(KD_eq+conc_nM)), start = list(R=Rstart,KD_eq=10), lower=c(Rminlim,1), upper=c(Rmaxlim,Inf), data=data, weights = (1/octet_eq)) return(fit_obj) } nlsLM_Hill_f &lt;- function(data, Rstart, Rminlim, Rmaxlim){ fit_obj &lt;- nlsLM(octet_eq ~ (octet_zero+(octet_max-octet_zero)/(1+(EC50/conc_nM)^hslope ) ), start = list(octet_max=Rstart, octet_zero=0, EC50=10,hslope=1), lower=c(Rminlim, 0, 1, 0.3), upper=c(Rmaxlim, 0, 100, 1.5), data=data, weights = (1/octet_eq)) return(fit_obj) } data_pall_csv_conc_titrations_ligand_eq_fit &lt;- data_pall_csv_conc_titrations_ligand_eq %&gt;% dplyr::select(-csv_shifted, -csv_shifted_eqphase) %&gt;% group_by(exprun_digit) %&gt;% group_modify(., ~mutate(.,Rstart=max(octet_eq))) %&gt;% group_modify(., ~mutate(.,Rmaxlim=Rstart+0.2*Rstart, Rminlim=Rstart-0.2*Rstart )) %&gt;% ungroup() %&gt;% group_by(exprun_digit, rec, meas_type, sample, ligand, meas_driftcorr, meas_salt, Rstart, Rmaxlim, Rminlim) %&gt;% nest() %&gt;% mutate(eq_KD_fit = purrr::pmap(list(data, Rstart, Rminlim, Rmaxlim), nlsLM_KD_f)) %&gt;% mutate(KD_results = map(eq_KD_fit, augment)) %&gt;% mutate(eq_Hill_fit = purrr::pmap(list(data, Rstart, Rminlim, Rmaxlim), nlsLM_Hill_f)) %&gt;% mutate(hill_results = map(eq_Hill_fit, augment)) %&gt;% mutate(kd_results = map(eq_KD_fit, augment)) %&gt;% mutate(kd_pars = map(eq_KD_fit, tidy)) %&gt;% mutate(hill_pars = map(eq_Hill_fit, tidy)) %&gt;% mutate(hill_results_mod = purrr::map(hill_results, ~dplyr::select(., octet_eq, conc_nM, hill_fit = &quot;.fitted&quot;))) %&gt;% mutate(kd_results_mod = purrr::map(kd_results, ~dplyr::select(., octet_eq, conc_nM, kd_fit = &quot;.fitted&quot;))) ### write fit parameters as csv files data_pall_csv_conc_titrations_ligand_eq_fit_pars_table &lt;- data_pall_csv_conc_titrations_ligand_eq_fit %&gt;% mutate(., hill_pars_long = purrr::map(hill_pars, ~pivot_longer(., 2:5, names_to = &quot;hill_stats&quot;, values_to = &quot;hill_stats_value&quot;)), kd_pars_long = purrr::map(kd_pars, ~pivot_longer(., 2:5, names_to = &quot;kd_stats&quot;, values_to = &quot;kd_stats_value&quot;)) ) %&gt;% mutate(., hill_pars_long_names = purrr::map(hill_pars_long, ~dplyr::select(., hill_term = term, 2:3)), kd_pars_long_names = purrr::map(kd_pars_long, ~dplyr::select(., kd_term = term, 2:3)) )%&gt;% dplyr::select(rec, hill_pars_long_names, kd_pars_long_names) ###Hill vline estimates data_pall_csv_conc_titrations_ligand_eq_fit_hill_estimate &lt;- data_pall_csv_conc_titrations_ligand_eq_fit_pars_table %&gt;% dplyr::select(., hill_pars_long_names) %&gt;% unnest(., c(&quot;hill_pars_long_names&quot;)) %&gt;% dplyr::filter(., (hill_term == &quot;EC50&quot; | hill_term == &quot;hslope&quot;) &amp; (hill_stats == &quot;estimate&quot; | hill_stats == &quot;std.error&quot;)) data_pall_csv_conc_titrations_ligand_eq_fit_hill_estimate_vline &lt;- data_pall_csv_conc_titrations_ligand_eq_fit_hill_estimate %&gt;% pivot_wider(., id_cols = c(&quot;sample&quot;, &quot;hill_term&quot;), names_from = c(&quot;hill_stats&quot;), values_from = c(&quot;hill_stats_value&quot;)) %&gt;% dplyr::filter(., hill_term == &quot;EC50&quot;) %&gt;% dplyr::mutate(., vline_estimate = estimate, vline_plus = estimate+std.error, vline_minus = estimate-std.error) %&gt;% dplyr::select(., -hill_term, -std.error, -estimate) %&gt;% pivot_longer(., c(2:ncol(.))) %&gt;% dplyr::select(., sample, vline_name = name, vline_value = value) %&gt;% dplyr::mutate(., vline_size = case_when(vline_name == &quot;vline_estimate&quot; ~ 2, vline_name == &quot;vline_plus&quot; ~ 1, vline_name == &quot;vline_minus&quot; ~ 1)) ### KD vline estimates data_pall_csv_conc_titrations_ligand_eq_fit_kd_estimate &lt;- data_pall_csv_conc_titrations_ligand_eq_fit_pars_table %&gt;% dplyr::select(., kd_pars_long_names) %&gt;% unnest(., c(&quot;kd_pars_long_names&quot;)) %&gt;% dplyr::filter(., (kd_term == &quot;KD_eq&quot;) &amp; (kd_stats == &quot;estimate&quot; | kd_stats == &quot;std.error&quot;)) data_pall_csv_conc_titrations_ligand_eq_fit_kd_estimate_vline &lt;- data_pall_csv_conc_titrations_ligand_eq_fit_kd_estimate %&gt;% pivot_wider(., id_cols = c(&quot;sample&quot;, &quot;kd_term&quot;), names_from = c(&quot;kd_stats&quot;), values_from = c(&quot;kd_stats_value&quot;)) %&gt;% dplyr::filter(., kd_term == &quot;KD_eq&quot;) %&gt;% dplyr::mutate(., vline_estimate = estimate, vline_plus = estimate+std.error, vline_minus = estimate-std.error) %&gt;% dplyr::select(., -kd_term, -std.error, -estimate) %&gt;% pivot_longer(., c(2:ncol(.))) %&gt;% dplyr::select(., sample, vline_name = name, vline_value = value) %&gt;% dplyr::mutate(., vline_size = case_when(vline_name == &quot;vline_estimate&quot; ~ 2, vline_name == &quot;vline_plus&quot; ~ 1, vline_name == &quot;vline_minus&quot; ~ 1)) data_pall_csv_conc_titrations_ligand_eq_fit_pars_table %&gt;% dplyr::select(., hill_pars_long_names) %&gt;% unnest(., c(&quot;hill_pars_long_names&quot;)) %&gt;% write_csv2(.,path = &quot;./ggplot_ligand_titrations_eqconc_fit_hill_pars.csv&quot;) data_pall_csv_conc_titrations_ligand_eq_fit_pars_table %&gt;% dplyr::select(., kd_pars_long_names) %&gt;% unnest(., c(&quot;kd_pars_long_names&quot;)) %&gt;% write_csv2(.,path = &quot;./ggplot_ligand_titrations_eqconc_fit_kd_pars.csv&quot;) ###plot Kd, Hill fit data_pall_csv_conc_titrations_ligand_eq_fit_kd &lt;- data_pall_csv_conc_titrations_ligand_eq_fit %&gt;% dplyr::select(rec, kd_results_mod) %&gt;% unnest(kd_results_mod) data_pall_csv_conc_titrations_ligand_eq_fit_hill &lt;- data_pall_csv_conc_titrations_ligand_eq_fit %&gt;% dplyr::select(rec, hill_results_mod) %&gt;% unnest(., hill_results_mod) data_pall_csv_conc_titrations_ligand_eq_fit_kd_hill &lt;- data_pall_csv_conc_titrations_ligand_eq_fit_kd %&gt;% left_join(.,data_pall_csv_conc_titrations_ligand_eq_fit_hill) data_pall_csv_conc_titrations_ligand_eq_fit_kd_plot_selected &lt;- data_pall_csv_conc_titrations_ligand_eq_fit_kd_hill %&gt;% left_join(., data_pall_csv_conc_titrations_ligand_eq_fit_kd_estimate_vline) %&gt;% dplyr::mutate(., octet = octet_eq) %&gt;% ggplot(data=., aes(x=conc_nM, y=octet, color=rec)) + #xlab(&quot;Vol /mL&quot;) + #ylab(&quot;Abs /mAU&quot;) +#xlim(c(0,1000)) +#ylim(c(-5,50)) + #geom_vline(xintercept = mwlines, color = &quot;red&quot;, linetype=&quot;dashed&quot;, size=0.5) + geom_point(size = 2) + #geom_line(aes(x=conc_nM_dimer, y=kd_fit)) + geom_line(aes(x=conc_nM, y=kd_fit)) + scale_x_log10(breaks = c(10^-3, 10^-2, 10^-1, 10^0, 10^1, 10^2, 10^3)) + scale_y_continuous(name = NULL, limits = c(0, 0.5)) + #scale_color_gradient2(low=&quot;green&quot;, mid=&quot;blue&quot;, high=&quot;red&quot;, space =&quot;Lab&quot;,midpoint=3, trans = &quot;log10&quot;) + #, facet_grid(exprun_digit ~ .) + scale_color_aaas() + geom_vline(aes(xintercept = vline_value, linetype = factor(vline_size*-1))) + theme_light() + #theme(legend.position = &quot;none&quot;) + theme(legend.position = &quot;none&quot;, strip.background = element_blank(), strip.text.y = element_blank()) print(data_pall_csv_conc_titrations_ligand_eq_fit_kd_plot_selected) ggsave(file=&quot;ggplot_ligand_titrations_eqconc_kdfit_selected.jpeg&quot;, plot=data_pall_csv_conc_titrations_ligand_eq_fit_kd_plot_selected,device=&quot;jpeg&quot;, width = 60, height = 80, units = c(&quot;mm&quot;)) Only the simple Langmuir fit was shown in Figures 3B and supplementary Figure 2A. see figure legend in ms for more details. 1.7 Fits of the sensorgrams using 1:1 local fit as implemented in ForteBio software Chunk to import data including local fits. Kinetic fitting data were exported in the same txt files comprising data with fits. The fit parameters listed in the file were used to calculate KD and kon dissociation constants according to http://csbi.mit.edu/instrumentation/ForteBio_App_Note_14.pdf data_dir_all_kinetics &lt;- data_dir_all %&gt;% dplyr::select(., dirname, sample, rec, exprun_digit, filterme, contains(&quot;meas_&quot;)) %&gt;% group_by(., sample, dirname, rec, exprun_digit, filterme, meas_type, meas_driftcorr, meas_salt) %&gt;% dplyr::summarize() %&gt;% dplyr::mutate(., csv_kinfolder = paste(dirname, &quot;Results_kd&quot;, filterme, sep = &quot;&quot;)) %&gt;% mutate(csv_kinfilelist = purrr::map(csv_kinfolder, ~list.files(path = ., pattern = &quot;*.txt&quot;,recursive = FALSE))) %&gt;% unnest(., csv_kinfilelist) %&gt;% dplyr::mutate(., csv_kinfilereadme = paste(csv_kinfolder, &quot;/&quot; , csv_kinfilelist, sep = &quot;&quot;)) %&gt;% mutate(csv = purrr::map(csv_kinfilereadme,~read_tsv(.,skip=8, col_names = c(&quot;time&quot;,&quot;octet&quot;,&quot;simulated&quot;))) ) %&gt;% mutate(csv_shifted = purrr::map(csv,~dplyr::mutate(.,time_shifted = time - min(time)))) %&gt;% dplyr::select(-csv) %&gt;% mutate(csv_shifted_rmsd = purrr::map(csv_shifted,~dplyr::mutate(.,residuals = simulated - octet))) data_dir_all_kinetics_parsimport &lt;- data_dir_all_kinetics %&gt;% mutate(fitpars = purrr::map(csv_kinfilereadme,~read_tsv(.,skip=0, col_names = c(&quot;fitparameter&quot;,&quot;value&quot;), n_max = 7)) ) data_dir_all_kinetics_pars &lt;- data_dir_all_kinetics_parsimport %&gt;% mutate(fitpars_wide = purrr::map(fitpars, ~pivot_wider(., names_from = c(&quot;fitparameter&quot;), values_from = c(&quot;value&quot;)) ) ) %&gt;% mutate(fitpars_wide_kon = purrr::map(fitpars_wide, ~dplyr::mutate(., Kon = (Kobs - Koff)/Conc1 ) ) ) %&gt;% mutate(fitpars_wide_kon = purrr::map(fitpars_wide_kon, ~dplyr::mutate(., KD_nM = (Koff/Kon)*10^9 ) ) ) pull_pars_f &lt;- function(df, parameter){ value &lt;- df %&gt;% dplyr::select(., c(parameter)) %&gt;% pull() return(value) } data_dir_all_kinetics_pars_csv_residual &lt;- data_dir_all_kinetics_pars %&gt;% dplyr::select(., sample, rec, exprun_digit, sensorcsv = csv_kinfilereadme, contains(&quot;meas_&quot;), csv_shifted_rmsd, fitpars_wide_kon) %&gt;% dplyr::mutate(., conc = purrr::pmap(list(fitpars_wide_kon, &quot;Conc1&quot;), pull_pars_f)) %&gt;% unchop(., c(&quot;conc&quot;)) %&gt;% dplyr::mutate(., conc_nM = conc *10^9) data_dir_all_kinetics_pars_KonVsKD &lt;- data_dir_all_kinetics_pars %&gt;% dplyr::select(., sample, rec, exprun_digit, filterme, contains(&quot;meas_&quot;), fitpars_wide_kon) %&gt;% unnest(., fitpars_wide_kon) %&gt;% dplyr::mutate(., Kon_corr = case_when(Kon &gt; 0 ~ Kon, Kon &lt; 0 ~ 0, TRUE ~ Kon)) %&gt;% dplyr::mutate(Kon_corr = na_if(Kon_corr, 0)) data_dir_all_kinetics_pars_KonVsKD_forplot &lt;- data_dir_all_kinetics_pars_KonVsKD %&gt;% dplyr::filter(meas_type == &quot;TIT&quot; &amp; exprun_digit &gt; 802) %&gt;% dplyr::mutate(.,conc_nM = Conc1*10^9) %&gt;% dplyr::mutate(., koff_log10 = log10(Koff), Kd_log10_nM = log10(KD_nM*10^-9)+9) %&gt;% dplyr::mutate(., value_norm = 0) data_dir_all_kinetics_pars_KonVsKD_2Dplot &lt;- data_dir_all_kinetics_pars_KonVsKD %&gt;% dplyr::mutate(.,conc_nM = Conc1*10^9) %&gt;% dplyr::filter(meas_type == &quot;TIT&quot; &amp; exprun_digit &gt; 802) %&gt;% ggplot(data=., aes(x=KD_nM, y=Kon, color=conc_nM)) + #xlab(&quot;Vol /mL&quot;) + #ylab(&quot;Abs /mAU&quot;) +#xlim(c(0,1000)) +#ylim(c(-5,50)) + #geom_vline(xintercept = mwlines, color = &quot;red&quot;, linetype=&quot;dashed&quot;, size=0.5) + geom_point(size = 2) + #geom_line(aes(x=conc_nM_dimer, y=kd_fit)) + #geom_line(aes(x=KD_nM, y=kd_fit)) + scale_x_log10(&quot;log10(Kd in nM)&quot;, breaks = c(10^-1, 10^0, 10^1, 10^2, 10^3), labels = function(breaks) log10(breaks)) + scale_y_log10(&quot;Kon: Ms-1&quot;, breaks = c(10^3, 10^4, 10^5, 10^6, 10^7), labels = function(breaks) log10(breaks)) + coord_cartesian(xlim = c(0.1, 1000), ylim = c(10^3, 10^7)) + scale_color_gradient2(low=&quot;green&quot;, mid=&quot;blue&quot;, high=&quot;red&quot;, space =&quot;Lab&quot;,midpoint=3, trans = &quot;log10&quot;) + #, facet_grid(exprun_digit ~ .) + #scale_color_aaas() + #geom_vline(aes(xintercept = vline_value, linetype = factor(vline_size*-1))) + theme_light() + theme(legend.position = &quot;left&quot;, strip.background = element_blank(), strip.text.y = element_blank()) + # remove facet legend + theme(legend.position = &quot;none&quot;) print(data_dir_all_kinetics_pars_KonVsKD_2Dplot) ggsave(file=&quot;ggplot_ligand_titrations_KDKon_log.jpeg&quot;, plot=data_dir_all_kinetics_pars_KonVsKD_2Dplot,device=&quot;jpeg&quot;, width = 60, height = 80, units = c(&quot;mm&quot;)) data_dir_all_kinetics_pars_KonVsKD_values &lt;- data_dir_all_kinetics_pars_KonVsKD %&gt;% dplyr::mutate(.,conc_nM = Conc1*10^9) %&gt;% dplyr::filter(meas_type == &quot;TIT&quot; &amp; exprun_digit &gt; 802) %&gt;% dplyr::select(., sample, exprun_digit, conc_nM, KD_nM, Kon, Koff, Kobs) %&gt;% ungroup() %&gt;% group_by(rec, exprun_digit) %&gt;% dplyr::filter(., KD_nM &gt; 10 &amp; KD_nM &lt; 100) %&gt;% dplyr::summarize(., Kon_median = median(Kon), Koff_median = median(Koff),KD_median = median(KD_nM), Kon_sd = sd(Kon), Koff_sd = sd(Koff),KD_sd = sd(KD_nM)) %&gt;% dplyr::mutate(., Kon_median_log = log10(Kon_median), Koff_median_log = log10(Koff_median), Kon_sd_log = log10(Kon_sd), Koff_sd_log = log10(Koff_sd)) %&gt;% dplyr::mutate(., Kon_upper_10to5 = (Kon_median + Kon_sd)*10^-5, Kon_lower_10to5 = (Kon_median - Kon_sd)*10^-5, Koff_upper_10tominus3 = (Koff_median + Koff_sd)*10^3, Koff_lower_10tominus3 = (Koff_median - Koff_sd)*10^3 ) Plotting on-rates versus log10(Kd in nM): 1 corresponds to 10 nM, 2 to 100 nM … / this plot was not used for the publication. 1.8 Tidying data for evilfit analysis and combined plots of local 1:1 fits vs. global bayesian 1:1 fits (Forte vs. Evilfit) Export data to be imported into Evilfit for Bayesian analysis to obtain two-dimensional distribution of KD and koff-rate constants to address heterogeneous ligand site populations on the sensor surface (Svitel et al. 2003)(Gorshkova et al. 2008). pick_id &lt;- c(seq(1,1000000,5)) data_dir_all_kinetics_evil1 &lt;- data_dir_all_kinetics %&gt;% ungroup() %&gt;% dplyr::filter(., exprun_digit &gt; 802) %&gt;% dplyr::select(., -csv_shifted, -dirname, -filterme, -meas_type, -meas_driftcorr, -csv_kinfolder) %&gt;% dplyr::mutate(., sensor = str_extract(csv_kinfilelist, &quot;[^[Result.txt]]&quot;)) %&gt;% unnest(., c(&quot;csv_shifted_rmsd&quot;)) %&gt;% dplyr::mutate(., octet1000 = octet*1000) %&gt;% ungroup() %&gt;% dplyr::select(., -csv_kinfilelist, csv_kinfilereadme) %&gt;% group_by(sample, sensor) %&gt;% nest() %&gt;% dplyr::mutate(., data_mod = purrr::map(data, ~dplyr::mutate(., octet1000pos = octet1000-min(octet1000)))) %&gt;% dplyr::select(-data) %&gt;% unnest(cols = c(&quot;data_mod&quot;)) %&gt;% pivot_longer(., cols = c(&quot;time&quot;, &quot;octet&quot;, &quot;simulated&quot;, &quot;time_shifted&quot;, &quot;residuals&quot;, &quot;octet1000&quot;, &quot;octet1000pos&quot;)) %&gt;% group_by(., sample, exprun_digit) %&gt;% nest() %&gt;% dplyr::mutate(data_wide = purrr::map(data, ~dplyr::group_by(., sensor, name))) %&gt;% dplyr::mutate(data_wide = purrr::map(data_wide, ~dplyr::mutate(., timeid = row_number()))) %&gt;% dplyr::mutate(data_wider = purrr::map(data_wide, ~pivot_wider(., id_cols = c(&quot;rec&quot;, &quot;meas_salt&quot;, &quot;timeid&quot;), names_from = c(&quot;name&quot;, &quot;sensor&quot;), values_from = c(&quot;value&quot;)) )) %&gt;% dplyr::mutate(data_wider_1s = purrr::map(data_wider, ~dplyr::filter(., timeid %in% pick_id ) )) %&gt;% dplyr::mutate(evil_exp = purrr::map(data_wider_1s, ~dplyr::select(., time_shifted_A, octet1000_A, time_shifted_B, octet1000_B, time_shifted_C, octet1000_C, time_shifted_D, octet1000_D, time_shifted_E, octet1000_E, time_shifted_F, octet1000_F, time_shifted_G, octet1000_G ) )) %&gt;% mutate(., evilname = paste(&quot;./&quot;, sample, &quot;_evil.xls&quot;, sep = &quot;&quot;)) pwalk(list(data_dir_all_kinetics_evil1$evil_exp, data_dir_all_kinetics_evil1$evilname), write_excel_csv) In Evilfit, it is possible to obtain a matlab file that can be imported into R for customized visualization. mat_pluck_f &lt;- function(df){ mattib &lt;- df %&gt;% enframe(.) %&gt;% pivot_wider(., names_from = c(&quot;name&quot;), values_from = c(&quot;value&quot;)) } mat_to_tib_f &lt;- function(evilmatrix, evilcolname){ idcolname &lt;- paste(evilcolname, &quot;id&quot;, sep = &quot;&quot;) eviltib &lt;- evilmatrix %&gt;% unlist(.) %&gt;% as_tibble(.) %&gt;% dplyr::mutate(., joinme = &quot;joinme&quot;) %&gt;% dplyr::mutate(., distrow = row_number(joinme)) %&gt;% set_colnames(c(evilcolname, &quot;joinme&quot;, idcolname)) return(eviltib) } distmat_to_tib_f &lt;- function(evilmatrix){ eviltib &lt;- evilmatrix %&gt;% dplyr::mutate(., melted = purrr::map(PlotConcMat, ~melt(.))) %&gt;% dplyr::select(., melted) %&gt;% unnest(., cols = c(&quot;melted&quot;)) %&gt;% dplyr::mutate(., joinme = &quot;joinme&quot;) %&gt;% set_colnames(c(&quot;Kdid&quot;, &quot;koffid&quot;, &quot;value&quot;, &quot;joinme&quot;)) return(eviltib) } # data_dir_evil &lt;- enframe(list.files(path = &quot;./evilfit&quot;, pattern = &quot;*.mat&quot;, full.names = TRUE, recursive=FALSE)) %&gt;% dplyr::select(., evilname = value) %&gt;% mutate(evilmat = purrr::map(evilname,~rmatio::read.mat(.) )) #add_matids_f &lt;- function(Kd_tib, koff_tib, plotdistr_tib){ # plotdistr_tib_mod &lt;- plotdistr_tib %&gt;% # return(plotdistr_tib_mod) #} #%&gt;% dplyr::mutate(., plotdistr_tib_mod = purrr::pmap(list(Kd_tib, koff_tib, plotdistr_tib), add_matids_f)) data_dir_evil_mat2 &lt;- data_dir_evil %&gt;% dplyr::mutate(., id = row_number(evilname)) %&gt;% dplyr::mutate(., Kdmatid = &quot;Kd&quot;, koffmatid = &quot;koff&quot;, distid = &quot;distribution&quot;) %&gt;% dplyr::mutate(., evilmat_wide = purrr::map(evilmat, ~mat_pluck_f(.))) %&gt;% dplyr::mutate(., Kd_mat = purrr::map(evilmat_wide, ~dplyr::select(., Kdlist)), koff_mat = purrr::map(evilmat_wide, ~dplyr::select(., kofflist)), dist_mat = purrr::map(evilmat_wide, ~dplyr::select(., PlotConcMat))) %&gt;% dplyr::mutate(Kd_tib = purrr::pmap(list(Kd_mat, Kdmatid), mat_to_tib_f), koff_tib = purrr::pmap(list(koff_mat, koffmatid), mat_to_tib_f), plotdistr_tib = purrr::map(dist_mat, ~distmat_to_tib_f(.))) %&gt;% dplyr::mutate(., plotdistr_tib_Kd = purrr::pmap(list(plotdistr_tib, Kd_tib), left_join)) %&gt;% dplyr::mutate(., plotdistr_tib_Kdkoff = purrr::pmap(list(plotdistr_tib_Kd, koff_tib), left_join)) %&gt;% dplyr::mutate(., plotdistr_tib_Kdkoff_log10 = purrr::map(plotdistr_tib_Kdkoff, ~dplyr::mutate(., Kd_log10_nM = log10(Kd*10^9), koff_log10 = log10(koff)))) %&gt;% dplyr::mutate(., plotdistr_tib_Kdkoff_log10_norm = purrr::map(plotdistr_tib_Kdkoff_log10, ~dplyr::mutate(., value_norm = (value/max(value)) ))) ## plot 2D distributions of fitted parameters inferno_colours &lt;- c(viridisLite::inferno(200)) plasma_colours &lt;- c(viridisLite::plasma(200)) plotdistr_tib_Kdkoff_log10_forplot &lt;- data_dir_evil_mat2 %&gt;% dplyr::select(., evilname, plotdistr_tib_Kdkoff_log10_norm) %&gt;% unnest(., cols = &quot;plotdistr_tib_Kdkoff_log10_norm&quot;) %&gt;% dplyr::mutate(., exprun = str_extract(evilname, pattern = &quot;x[:digit:]{4}&quot;)) %&gt;% dplyr::mutate(., exprun_digit = str_extract(exprun, pattern = &quot;[:digit:]{4}&quot;)) %&gt;% dplyr::mutate_at(., vars(matches(&quot;exprun_digit&quot;)), as.numeric) %&gt;% dplyr::select(., exprun_digit, Kd_log10_nM, koff_log10, value_norm) plotdistr_tib_Kdkoff_log10_plot &lt;- plotdistr_tib_Kdkoff_log10_forplot %&gt;% ggplot(., ) + #contourplot(value ~ Kd_log10_nM * koff_log10, data = ., cuts = 10) + #geom_raster(aes(fill = value_norm), interpolate = TRUE) + #geom_tile(aes(x = Kd_log10_nM, y = koff_log10, fill = value_norm), linejoin = &quot;mitre&quot;) + #stat_contour(colour = &quot;white&quot;, size = 0.1, breaks = c(1/3, 2/3)) + stat_contour(aes(x = Kd_log10_nM, y = koff_log10, z = value_norm, colour = ..level..), size = 0.25, bins = 10) + #scale_colour_viridis_c() + scale_colour_gradient(low = &quot;blue&quot;, high = &quot;red&quot;, space = &quot;Lab&quot;) + #scale_fill_gradientn(colours = plasma_colours, space = &quot;Lab&quot;, breaks = c(0/3, 1/3, 2/3, 3/3), labels = function(breaks) round(breaks, 2)) + #scale_colour_gradientn(colours = terrain.colors(10)) + geom_point(data = data_dir_all_kinetics_pars_KonVsKD_forplot, aes(x = Kd_log10_nM, y = koff_log10), colour = &quot;black&quot;, shape = 3, size = 0.5) + scale_x_continuous(name = &quot;KD: nM&quot;, breaks = c(-3, -2, -1, 0, 1, 2, 3), labels = function(breaks) 10^breaks) + scale_y_continuous(name = &quot;koff s-1&quot;) + facet_grid(exprun_digit ~ .) + # remove facet legend + theme_light() + theme(legend.position = &quot;left&quot;, strip.background = element_blank(), strip.text.y = element_blank()) #coord_cartesian(ylim = c(10^3, 10^7)) + #scale_color_gradient2(low=&quot;green&quot;, mid=&quot;blue&quot;, high=&quot;red&quot;, midpoint = 10, space =&quot;Lab&quot;) print(plotdistr_tib_Kdkoff_log10_plot) ggsave(&quot;plotdistr_tib_Kdkoff_log10_plot.jpeg&quot;, plotdistr_tib_Kdkoff_log10_plot, width = 120, height = 60, units = &quot;mm&quot;) ggsave(&quot;plotdistr_tib_Kdkoff_log10_plot.ps&quot;, plotdistr_tib_Kdkoff_log10_plot, width = 120, height = 60, units = &quot;mm&quot;) Direct comparison of the obtained koff vs. Kd distribution of the two titrations. Plots were used for Figures 3B and supplementary Figure 2A. see ms figure legend in ms for more details. some more transformations… # contourlpots different way but not as nice #plotdistr_tib_Kdkoff_log10_forcontourplot &lt;- as.data.frame(plotdistr_tib_Kdkoff_log10_forplot) #plotdistr_tib_Kdkoff_log10_contourplot &lt;- contourplot(..value ~ ..Kd_log10_nM * ..koff_log10 | ..exprun_digit , data = plotdistr_tib_Kdkoff_log10_forcontourplot, cuts = 8, region = TRUE, col.regions = heat.colors(800)) datamat_to_tib_f &lt;- function(evilmatrix){ eviltib &lt;- evilmatrix %&gt;% dplyr::mutate(., data_melted = purrr::map(signalmats, ~melt(.))) %&gt;% dplyr::select(., data_melted) %&gt;% dplyr::mutate(., joinme = &quot;joinme&quot;) %&gt;% unnest(., cols = c(&quot;data_melted&quot;)) %&gt;% set_colnames(c(&quot;type&quot;, &quot;id&quot;, &quot;value&quot;, &quot;curve&quot;, &quot;dropme1&quot;, &quot;dropme2&quot;, &quot;joinme&quot;)) %&gt;% dplyr::mutate(., meastype = case_when(type == 1 ~ &quot;time_s&quot;, type == 2 ~ &quot;octet_1000&quot;)) %&gt;% dplyr::mutate(., curve_point = paste(&quot;id&quot;, curve, id, sep = &quot;_&quot;) ) %&gt;% dplyr::select(., curve, curve_point, meastype, value) %&gt;% pivot_wider(., names_from = c(&quot;meastype&quot;), values_from = c(&quot;value&quot;)) return(eviltib) } fitmat_to_tib_f &lt;- function(evilmatrix){ eviltib &lt;- evilmatrix %&gt;% dplyr::mutate(., fits_melted = purrr::map(fits, ~melt(.))) %&gt;% dplyr::select(., fits_melted) %&gt;% dplyr::mutate(., joinme = &quot;joinme&quot;) %&gt;% unnest(., cols = c(&quot;fits_melted&quot;)) %&gt;% set_colnames(c(&quot;type&quot;, &quot;id&quot;, &quot;value&quot;, &quot;curve&quot;, &quot;dropme1&quot;, &quot;dropme2&quot;, &quot;joinme&quot;)) %&gt;% dplyr::mutate(., meastype = case_when(type == 1 ~ &quot;time_s&quot;, type == 2 ~ &quot;evilfit_1000&quot;)) %&gt;% dplyr::mutate(., curve_point = paste(&quot;id&quot;, curve, id, sep = &quot;_&quot;) ) %&gt;% dplyr::select(., curve, curve_point, meastype, value) %&gt;% pivot_wider(., names_from = c(&quot;meastype&quot;), values_from = c(&quot;value&quot;)) return(eviltib) } join_data_dir_all_kinetics_pars_KonVsKD &lt;- data_dir_all_kinetics_pars_KonVsKD %&gt;% dplyr::filter(., exprun_digit &gt; 802) %&gt;% ungroup() %&gt;% dplyr::select(sample, Conc1) %&gt;% dplyr::mutate(., conc_nM = Conc1*10^9) %&gt;% group_by(., sample) %&gt;% dplyr::mutate(., curve = row_number(sample)) %&gt;% dplyr::select(-Conc1) %&gt;% ungroup() %&gt;% group_by(sample) %&gt;% nest(.) %&gt;% dplyr::select(sample, meas_parameters = data) ## get used data/fit/rmsd for plotting data_dir_evil_mat2_dataVsfit &lt;- data_dir_evil_mat2 %&gt;% dplyr::mutate(., sample = str_extract(evilname, pattern = &quot;[:digit:]{6}xSAXxNB1AxRBDHisxTITx[:digit:]{4}&quot;)) %&gt;% dplyr::mutate(., evildata = purrr::pmap(list(evilmat_wide), datamat_to_tib_f)) %&gt;% left_join(., join_data_dir_all_kinetics_pars_KonVsKD) %&gt;% dplyr::mutate(., evildata_par = purrr::pmap(list(evildata, meas_parameters), left_join)) %&gt;% dplyr::mutate(., evilfit = purrr::pmap(list(evilmat_wide), fitmat_to_tib_f)) %&gt;% dplyr::mutate(., evilfit_par = purrr::pmap(list(evilfit, meas_parameters), left_join)) %&gt;% dplyr::mutate(., evildataVsfit = purrr::pmap(list(evildata_par, evilfit_par), left_join)) %&gt;% dplyr::mutate(., evildataVsfit_res = purrr::map(evildataVsfit, ~dplyr::mutate(., datafit_res_1000 = evilfit_1000 - octet_1000))) %&gt;% dplyr::mutate(., evildataVsfit_res_nm = purrr::map(evildataVsfit_res, ~dplyr::mutate(., octet = octet_1000/1000, evilfit = evilfit_1000/1000, evilfit_res = datafit_res_1000/1000))) #KDs in nM, koff in 10^-3 (tm3), octet was multiplied by 1000 evilpeaks_manual_trib &lt;- tribble(~sample, ~peak_id, ~peak_KD_nM, ~peak_koff_tm3, ~peak_area, ~total_area, ~total_rmsd, &quot;200529xSAXxNB1AxRBDHisxTITx0901_evilexportall&quot;, 1, 5.2, 4.2, 151, 1418, 4.1, &quot;200529xSAXxNB1AxRBDHisxTITx0901_evilexportall&quot;, 2, 6.6, 1*10^-4, 928, 1418, 4.1, &quot;200529xSAXxNB1AxRBDHisxTITx1001_evilexportall&quot;, 1, 8.8, 5.1, 115, 998,3.0, &quot;200529xSAXxNB1AxRBDHisxTITx1001_evilexportall&quot;, 1, 6.9, 4.1*10^-4, 287, 998,3) 1.9 Combining the local fits with bayesian analysis in a single plot data_dir_all_csv_titrations_sel_fortefit_join &lt;- data_dir_all_kinetics_pars_csv_residual %&gt;% ungroup() %&gt;% dplyr::select(., sample, conc_nM, exprun_digit, meas_salt, csv_shifted_rmsd) %&gt;% dplyr::filter(exprun_digit &gt; 802) %&gt;% dplyr::mutate(., plotgroup = paste(sample, conc_nM, sep = &quot;_&quot;)) %&gt;% unnest(., cols = c(&quot;csv_shifted_rmsd&quot;)) %&gt;% dplyr::select(., -time) %&gt;% group_by(sample) %&gt;% nest() %&gt;% dplyr::select(., fortefit = data) evilfit_join &lt;- data_dir_evil_mat2_dataVsfit %&gt;% dplyr::select(sample, evildataVsfit_res_nm) %&gt;% unnest(., cols = c(&quot;evildataVsfit_res_nm&quot;)) %&gt;% dplyr::select(., sample, time_shifted = time_s, eviloctet = octet, evilfit, evilfit_res, conc_nM) %&gt;% dplyr::mutate(., plotgroup = paste(sample, conc_nM, sep = &quot;_&quot;)) %&gt;% group_by(., sample) %&gt;% nest() %&gt;% dplyr::select(., evilfit = data) forte_evil_fits_combined &lt;- data_dir_all_csv_titrations_sel_fortefit_join %&gt;% left_join(., evilfit_join) fortefit_nesting_f &lt;- function(df){ df_nested &lt;- df %&gt;% group_by(., plotgroup, conc_nM) %&gt;% nest(.) %&gt;% dplyr::select(., plotgroup, conc_nM, forte_nested = data) return(df_nested) } evilfit_nesting_f &lt;- function(df){ df_nested &lt;- df %&gt;% group_by(., plotgroup, conc_nM) %&gt;% nest(.) %&gt;% dplyr::select(., plotgroup, conc_nM, evil_nested = data) return(df_nested) } check_octet_value_f &lt;- function(df){ df %&gt;% dplyr::filter(., time_shifted &gt; 90 &amp; time_shifted &lt; 120) %&gt;% dplyr::filter(., time_shifted == min(time_shifted)) %&gt;% dplyr::select(., contains(&quot;octet&quot;)) %&gt;% pull() } addtoevil_f &lt;- function(df, addtoevil){ df_added &lt;- df %&gt;% dplyr::mutate(., evilfit_corr = evilfit + addtoevil) return(df_added) } forte_evil_fits_combined_join &lt;- forte_evil_fits_combined %&gt;% dplyr::mutate(., fortefit_nested = purrr::map(fortefit, ~fortefit_nesting_f(.))) %&gt;% dplyr::mutate(., evilfit_nested = purrr::map(evilfit, ~evilfit_nesting_f(.))) %&gt;% dplyr::mutate(., fortenested_evilnested_combined = purrr::pmap(list(fortefit_nested, evilfit_nested), left_join)) forte_evil_fits_combined_forplot &lt;- forte_evil_fits_combined_join %&gt;% dplyr::select(sample, fortenested_evilnested_combined) %&gt;% unnest(., cols = c(&quot;fortenested_evilnested_combined&quot;)) %&gt;% dplyr::mutate(., data_octet = purrr::map(forte_nested, ~check_octet_value_f(.)), evil_octet = purrr::map(evil_nested, ~check_octet_value_f(.))) %&gt;% unchop(., c(&quot;data_octet&quot;, &quot;evil_octet&quot;)) %&gt;% dplyr::mutate(., addtoevil = data_octet - evil_octet) %&gt;% dplyr::mutate(., evil_nested_corr = purrr::pmap(list(evil_nested, addtoevil), addtoevil_f)) select_eviltimes_f &lt;- function(forte_nested, evil_times){ eviltimes_vector &lt;- evil_times %&gt;% dplyr::mutate_if(is.numeric, as.integer) %&gt;% pull() forte_nested_out &lt;- forte_nested %&gt;% dplyr::mutate(., timeid = row_number()) %&gt;% dplyr::filter(., timeid %in% pick_id ) %&gt;% dplyr::mutate_at(c(&quot;time_shifted&quot;), as.integer) %&gt;% dplyr::filter(., time_shifted %in% eviltimes_vector) return(forte_nested_out) } addevilbase_f &lt;- function(forte_nested_cut, evil_nested){ evil_nested_combine &lt;- evil_nested %&gt;% dplyr::mutate_at(c(&quot;time_shifted&quot;), as.integer) forte_evil_combined &lt;- forte_nested_cut %&gt;% left_join(., evil_nested_combine) %&gt;% dplyr::mutate(., addevil = eviloctet - octet) %&gt;% dplyr::mutate(., evilfit_corr = evilfit - addevil) } forte_evil_fits_combined_forplot_corrected &lt;- forte_evil_fits_combined_forplot %&gt;% dplyr::mutate(., evil_times = purrr::map(evil_nested, ~dplyr::select(., time_shifted))) %&gt;% dplyr::mutate(., forte_nested_cut = purrr::pmap(list(forte_nested, evil_times), select_eviltimes_f)) %&gt;% dplyr::mutate(forte_evil_combined = purrr::pmap(list(forte_nested_cut, evil_nested), addevilbase_f)) %&gt;% dplyr::select(., sample, plotgroup, conc_nM, forte_evil_combined) %&gt;% unnest(., cols = c(&quot;forte_evil_combined&quot;)) evilfit_forplot &lt;- forte_evil_fits_combined_forplot %&gt;% dplyr::select(., sample, plotgroup, conc_nM, evil_nested_corr) %&gt;% unnest(., cols = c(&quot;evil_nested_corr&quot;)) %&gt;% dplyr::mutate(., residuals_fittype = &quot;evil&quot;) fortefit_forplot &lt;- forte_evil_fits_combined_forplot %&gt;% dplyr::select(., sample, plotgroup, conc_nM, forte_nested) %&gt;% unnest(., cols = c(&quot;forte_nested&quot;)) %&gt;% dplyr::mutate(., residuals_fittype = &quot;forte&quot;) forte_evil_fits_combined_plot &lt;- ggplot() + #ylab(&quot;Abs /mAU&quot;) +#xlim(c(0,1000)) +#ylim(c(-5,50)) + #geom_vline(xintercept = mwlines, color = &quot;red&quot;, linetype=&quot;dashed&quot;, size=0.5) + #geom_point(size = 2, stroke = 0.1, alpha=0.2, colour = &quot;black&quot;) + geom_line(data = fortefit_forplot, aes(x=time_shifted, y=octet, colour=conc_nM, group = plotgroup), size=0.6) + geom_line(data= fortefit_forplot, aes(x=time_shifted,y=simulated, group = plotgroup), size=0.3, colour = &quot;grey&quot;) + geom_line(data = evilfit_forplot, aes(x=time_shifted,y=evilfit_corr, group = plotgroup), size=0.3, colour = &quot;black&quot;) + scale_x_continuous(&quot;time: min&quot;, breaks = c(0, 900, 1800, 2700, 3600), labels = function(breaks) breaks/60) + scale_y_continuous(&quot;octet: nm&quot;, limits = c(0, 0.5)) + scale_colour_gradient2(low=&quot;green&quot;, mid = &quot;blue&quot;, high=&quot;red&quot;, midpoint = 10 ,space =&quot;Lab&quot;, trans = &quot;log2&quot;) + #, facet_grid(sample ~ ., scales = &quot;free_y&quot;) + #facet_grid_paginate(index ~ rec, ncol=2, nrow=4, page = i) + theme_light() + guides(fill = guide_legend(title.theme = element_text(size = 10))) + #change text size in legend theme(legend.position = &quot;left&quot;, strip.background = element_blank(), strip.text.y = element_blank()) # remove facet legend print(forte_evil_fits_combined_plot) #ggsave(file=&quot;ggplot_ligand_ligand_temp.jpeg&quot;, plot=data_dir_all_csv_titrations_plot,device=&quot;jpeg&quot;) ggsave(file=&quot;./forte_evil_fits_combined_plot.jpeg&quot;, device=&quot;jpeg&quot;, width = 160, height = 80, units = c(&quot;mm&quot;)) #ggsave(file=&quot;./ggplot_ligand_ligand.ps&quot;, width = 120, height = 110, units = c(&quot;mm&quot;)) Local and bayesian fits versus data. Plots were used for Figures 3B and supplementary Figure 2A. see ms figure legend in ms for more details. forte_evil_fits_combined_plot_corrected &lt;- forte_evil_fits_combined_forplot_corrected %&gt;% ggplot(data = .) + #ylab(&quot;Abs /mAU&quot;) +#xlim(c(0,1000)) +#ylim(c(-5,50)) + #geom_vline(xintercept = mwlines, color = &quot;red&quot;, linetype=&quot;dashed&quot;, size=0.5) + #geom_point(size = 2, stroke = 0.1, alpha=0.2, colour = &quot;black&quot;) + geom_line(aes(x=time_shifted, y=octet, colour=conc_nM, group = plotgroup), size=0.6) + geom_line(aes(x=time_shifted,y=simulated, group = plotgroup), size=0.3, colour = &quot;grey&quot;) + geom_line(aes(x=time_shifted,y=evilfit_corr, group = plotgroup), size=0.3, colour = &quot;black&quot;) + scale_x_continuous(&quot;time: min&quot;, breaks = c(0, 900, 1800, 2700, 3600), labels = function(breaks) breaks/60) + scale_y_continuous(&quot;octet: nm&quot;, limits = c(0, 0.5)) + scale_colour_gradient2(low=&quot;green&quot;, mid = &quot;blue&quot;, high=&quot;red&quot;, midpoint = 10 ,space =&quot;Lab&quot;, trans = &quot;log2&quot;) + #, facet_grid(sample ~ ., scales = &quot;free_y&quot;) + #facet_grid_paginate(index ~ rec, ncol=2, nrow=4, page = i) + theme_light() + guides(fill = guide_legend(title.theme = element_text(size = 10))) + #change text size in legend theme(legend.position = &quot;left&quot;, strip.background = element_blank(), strip.text.y = element_blank()) # remove facet legend print(forte_evil_fits_combined_plot_corrected) #ggsave(file=&quot;ggplot_ligand_ligand_temp.jpeg&quot;, plot=data_dir_all_csv_titrations_plot,device=&quot;jpeg&quot;) ggsave(file=&quot;./forte_evil_fits_combined_plot_corrected.jpeg&quot;, device=&quot;jpeg&quot;, width = 160, height = 80, units = c(&quot;mm&quot;)) #ggsave(file=&quot;./ggplot_ligand_ligand.ps&quot;, width = 120, height = 110, units = c(&quot;mm&quot;)) Same plot as the previous one. However, in Evilfit the fit also comprised a baseline subtraction, which had to be added to the bayesian fits for the visualization. In the first published version, this addition was not 100% correct, but fine for visualization purposes. If you compare the previous version with this new correct one, you hardly notice any difference. forte_fits_combined_resplot &lt;- ggplot() + #ylab(&quot;Abs /mAU&quot;) +#xlim(c(0,1000)) +#ylim(c(-5,50)) + #geom_vline(xintercept = mwlines, color = &quot;red&quot;, linetype=&quot;dashed&quot;, size=0.5) + #geom_point(size = 2, stroke = 0.1, alpha=0.2, colour = &quot;black&quot;) + geom_line(data=fortefit_forplot, aes(x=time_shifted, y=residuals, colour=conc_nM, group = plotgroup), size=0.5) + #geom_line(aes(x=time_shifted,y=simulated), size=0.5, alpha = 0.5) + scale_x_continuous(name = NULL, breaks = c(0, 900, 1800, 2700, 3600), labels = function(breaks) breaks/60) + scale_y_continuous(&quot;octet: nm&quot;, limits = c(-0.1, 0.1), breaks = c(-0.1, 0, 0.1)) + scale_colour_gradient2(low=&quot;green&quot;, mid = &quot;blue&quot;, high=&quot;red&quot;, midpoint = 10 ,space =&quot;Lab&quot;, trans = &quot;log2&quot;) + #, facet_grid(sample ~ ., scales = &quot;free_y&quot;) + #facet_grid_paginate(index ~ rec, ncol=2, nrow=4, page = i) + theme_light() + guides(fill = guide_legend(title.theme = element_text(size = 10))) + #change text size in legend theme(legend.position = &quot;left&quot;, strip.background = element_blank(), strip.text.y = element_blank()) # remove facet legend print(forte_fits_combined_resplot) #ggsave(file=&quot;ggplot_ligand_ligand_temp.jpeg&quot;, plot=data_dir_all_csv_titrations_plot,device=&quot;jpeg&quot;) ggsave(file=&quot;./forte_fits_combined_resplot.jpeg&quot;, device=&quot;jpeg&quot;, width = 160, height = 80, units = c(&quot;mm&quot;)) #ggsave(file=&quot;./ggplot_ligand_ligand_fortefit_sel_resplot.ps&quot;, plot = data_dir_all_csv_titrations_sel_fortefit_resplot, device = &quot;ps&quot;, width = 160, height = 80, units = c(&quot;mm&quot;)) Residuals of local fits versus data. Plots were not used. evil_fits_combined_resplot &lt;- ggplot() + #ylab(&quot;Abs /mAU&quot;) +#xlim(c(0,1000)) +#ylim(c(-5,50)) + #geom_vline(xintercept = mwlines, color = &quot;red&quot;, linetype=&quot;dashed&quot;, size=0.5) + #geom_point(size = 2, stroke = 0.1, alpha=0.2, colour = &quot;black&quot;) + geom_line(data=evilfit_forplot, aes(x=time_shifted, y=evilfit_res, colour=conc_nM, group = plotgroup), size=0.5) + #geom_line(aes(x=time_shifted,y=simulated), size=0.5, alpha = 0.5) + scale_x_continuous(name = NULL, breaks = c(0, 900, 1800, 2700, 3600), labels = function(breaks) breaks/60) + scale_y_continuous(&quot;octet: nm&quot;, limits = c(-0.1, 0.1), breaks = c(-0.1, 0, 0.1)) + scale_colour_gradient2(low=&quot;green&quot;, mid = &quot;blue&quot;, high=&quot;red&quot;, midpoint = 10 ,space =&quot;Lab&quot;, trans = &quot;log2&quot;) + #, facet_grid(sample ~ ., scales = &quot;free_y&quot;) + #facet_grid_paginate(index ~ rec, ncol=2, nrow=4, page = i) + theme_light() + guides(fill = guide_legend(title.theme = element_text(size = 10))) + #change text size in legend theme(legend.position = &quot;left&quot;, strip.background = element_blank(), strip.text.y = element_blank()) # remove facet legend print(evil_fits_combined_resplot) #ggsave(file=&quot;ggplot_ligand_ligand_temp.jpeg&quot;, plot=data_dir_all_csv_titrations_plot,device=&quot;jpeg&quot;) ggsave(file=&quot;./evil_fits_combined_resplot.jpeg&quot;, device=&quot;jpeg&quot;, width = 160, height = 80, units = c(&quot;mm&quot;)) Residuals of bayesian fits versus data. Plots were not used. 1.10 Assembling figures for manuscript In this step the pre-figures were pre-assembled, then imported into Adobe illustrator for final polishing. # plot for biorxiv #data_dir_all_csv_titrations_sel_forteplot_kdfit_combplot &lt;- ggpubr::ggarrange(data_dir_all_csv_titrations_sel_fortefit_plot, data_pall_csv_conc_titrations_ligand_eq_fit_kd_plot_selected, data_dir_sensorloads_sel_plot, data_dir_all_csv_titrations_sel_fortefit_resplot, data_dir_all_kinetics_pars_KonVsKD_2Dplot, common.legend = TRUE, nrow = 2, ncol = 3, legend = &quot;none&quot;, heights = c(5, 2)) #ggsave(file=&quot;ggplot_ligand_titrations_kdfit_combplot.jpeg&quot;, plot=data_dir_all_csv_titrations_sel_forteplot_kdfit_combplot,device=&quot;jpeg&quot;, width = 160, height = 100, units = c(&quot;mm&quot;)) #ggsave(file=&quot;ggplot_ligand_titrations_kdfit_combplot.ps&quot;, plot=data_dir_all_csv_titrations_sel_forteplot_kdfit_combplot,device=&quot;ps&quot;, width = 160, height = 100, units = c(&quot;mm&quot;)) # plot for new submission data_dir_all_csv_comp_combplot &lt;- ggpubr::ggarrange(data_dir_all_csv_comp_forteplot, data_dir_sensorloads_comp_plot, common.legend = TRUE, nrow = 1, ncol = 2, widths = c(0.3125, 0.1875)) ggsave(file=&quot;data_dir_all_csv_comp_combplot.jpeg&quot;, plot=data_dir_all_csv_comp_combplot,device=&quot;jpeg&quot;, width = 70, height = 40, units = c(&quot;mm&quot;)) ggsave(file=&quot;data_dir_all_csv_comp_combplot.ps&quot;, plot=data_dir_all_csv_comp_combplot,device=&quot;ps&quot;, width = 70, height = 40, units = c(&quot;mm&quot;)) data_dir_all_csv_titrations_sel_forteplot_kdfit_combplot_pre1 &lt;- ggpubr::ggarrange(forte_fits_combined_resplot, evil_fits_combined_resplot, common.legend = TRUE, nrow = 2, ncol = 1,legend = &quot;none&quot;) ggsave(file=&quot;data_dir_all_csv_titrations_sel_forteplot_kdfit_combplot_pre.jpeg&quot;, plot=data_dir_all_csv_titrations_sel_forteplot_kdfit_combplot_pre1,device=&quot;jpeg&quot;, width = 80, height = 60, units = c(&quot;mm&quot;)) data_dir_all_csv_titrations_sel_forteplot_kdfit_combplot_pre2 &lt;- ggpubr::ggarrange(data_dir_sensorloads_sel_plot, data_dir_sensorloads_sel_plot, common.legend = TRUE, nrow = 2, ncol = 1,legend = &quot;none&quot;) ggsave(file=&quot;data_dir_all_csv_titrations_sel_forteplot_kdfit_combplot_pre2.jpeg&quot;, plot=data_dir_all_csv_titrations_sel_forteplot_kdfit_combplot_pre2,device=&quot;jpeg&quot;, width = 80, height = 60, units = c(&quot;mm&quot;)) data_dir_all_csv_titrations_sel_forteplot_kdfit_combplot_new &lt;- ggpubr::ggarrange(forte_evil_fits_combined_plot, data_pall_csv_conc_titrations_ligand_eq_fit_kd_plot_selected, data_dir_sensorloads_sel_plot, plotdistr_tib_Kdkoff_log10_plot, data_dir_all_csv_titrations_sel_forteplot_kdfit_combplot_pre1, common.legend = TRUE, nrow = 2, ncol = 4, legend = &quot;none&quot;, heights = c(3, 3), widths = c(2.5, 1.5, 1.5, 2.5)) print(data_dir_all_csv_titrations_sel_forteplot_kdfit_combplot_new) ggsave(file=&quot;ggplot_ligand_titrations_kdfit_combplot_new.jpeg&quot;, plot=data_dir_all_csv_titrations_sel_forteplot_kdfit_combplot_new,device=&quot;jpeg&quot;, width = 140, height = 140, units = c(&quot;mm&quot;)) ggsave(file=&quot;ggplot_ligand_titrations_kdfit_combplot_new.ps&quot;, plot=data_dir_all_csv_titrations_sel_forteplot_kdfit_combplot_new,device=&quot;ps&quot;, width = 140, height = 140, units = c(&quot;mm&quot;)) This is the almost final figure that was used to generate Figures 3B and supplemental Figure 2A. 1.11 Looking at expected maximum responses based on ligand/analyte MW ratios pull_KDpars_f &lt;- function(df){ df_mod &lt;- df %&gt;% dplyr::filter(., kd_stats == kd_stats) %&gt;% dplyr::select(kd_term, kd_stats_value) %&gt;% pivot_wider(., names_from = c(&quot;kd_stats&quot;, &quot;kd_term&quot;), names_sep = &quot;_&quot;, values_from =c(&quot;kd_stats_value&quot;)) return(df_mod) } response_ratios_Rmax &lt;- data_pall_csv_conc_titrations_ligand_eq_fit_pars_table %&gt;% dplyr::select(., sample, rec, exprun_digit,kd_pars_long_names) %&gt;% dplyr::mutate(., kd_pars_ratio = purrr::map(kd_pars_long_names, ~dplyr::filter(., kd_stats == &quot;estimate&quot;)) ) response_ratios_Rmax_join &lt;- response_ratios_Rmax %&gt;% dplyr::select(., -kd_pars_long_names) %&gt;% unnest(., c(&quot;kd_pars_ratio&quot;)) %&gt;% dplyr::filter(., exprun_digit &gt; 802) %&gt;% ungroup() %&gt;% dplyr::select(sample, kd_term, kd_stats_value) %&gt;% dplyr::filter(., kd_term == &quot;R&quot;) response_ratios &lt;- data_dir_sensors_raw_xls_longer_sensorloads_unnested %&gt;% dplyr::filter(., exprun_digit &gt; 802) %&gt;% dplyr::select(., sample, rec, exprun_digit, sensor, diff_id1) %&gt;% group_by(sample) %&gt;% dplyr::summarize(., mean_load = mean(diff_id1),mean_sd = sd(diff_id1)) %&gt;% left_join(., response_ratios_Rmax_join) %&gt;% dplyr::mutate(., Rratio = kd_stats_value/mean_load) response_ratios_kable &lt;- response_ratios %&gt;% dplyr::mutate(., sensor_load = round(mean_load, 2), sensor_load_sd = round(mean_sd, 2), bound_max = round(kd_stats_value, 2), load_signal_ratio = round(Rratio, 1)) %&gt;% dplyr::select(., sensor_load, sensor_load_sd, bound_max, load_signal_ratio) kable(response_ratios_kable, caption = &quot;**Calculated maximum response versus load ratios.**&quot;) Table 1.1: Calculated maximum response versus load ratios. sensor_load sensor_load_sd bound_max load_signal_ratio 0.18 0.01 0.38 2.1 0.18 0.00 0.35 2.0 MW-based response estimation is typically applied to obtain estimates about active ligand concentrations as well as ligand acitivity of SPR data (Merwe 2003). This relation is not established for BLI and was therefore not mentioned in the ms. However, it is interesting to note that the response/load ratio of 2 closely matches the theoretically expected ratio based on the MW of Ty1 and RBD with MW of 14 and 25 kDa, respectively. 2 Analysis of ITC data Although the octet binding data clearly revealed specific binding, local fits and bayesian analysis indicated sensor surface related deviations from a perfect 1:1 binding. Therefore we also established in solution ITC measurements in order to exclude any surface-related artifacts of the determined affinity values. Data and binding parameters were analyzed using the MicroCal PeakITC software (Malvern), applying the 1:1 binding model with following equations as described in detalil in the software manual: The two most important equations for analysis are re-written in the following. \\[\\begin{equation} Q = \\frac{nM_t\\Delta HV_0}{2}[1+\\frac{X_t}{nM_t}+\\frac{1}{nKM_t}-\\sqrt{(1+\\frac{X_t}{nM_t}+\\frac{1}{nKM_t})^2-\\frac{4X_t}{nM_t}} \\tag{2.1} \\end{equation}\\] This expression for the heat change Q only applies to the liquid contained in volume \\(V_0\\) of the cell. Therefore, the equation is corrected for the displaced volume after each injection: \\[\\begin{equation} \\Delta Q(i)=Q(i)+\\frac{dV_i}{V_0}(\\frac{Q(i)+Q(i-1)}{2})-Q(i-1) \\tag{2.2} \\end{equation}\\] with K: binding constant, n: number of sites, M: free concentration of macromolecule in active volume (NTF2 dimer), X: free concentration of ligand (USP or CAP), \\(\\Delta H\\): molar heat of binding. The software also gives out the Gibbs enery from \\(\\Delta G = -RTlnK\\) and the entropy cost (-T\\(\\Delta S\\)) from \\(\\Delta G = \\Delta H - T\\Delta S\\). 2.1 importing ITC data The processed data were exported from MicroCal PeakITC software (Malvern) as csv files and imported using following code. filelist_itc = list.files(path = &quot;./data_itc/&quot;, pattern = &quot;*.csv&quot;) filelist_itc.dat &lt;- data.frame(folder = c(rep(&quot;./data_itc/&quot;, length(filelist_itc))), files = filelist_itc) filelist_itc.dat$read &lt;- paste(filelist_itc.dat$folder, filelist_itc.dat$files, sep = &quot;&quot;) filelist_itc.tib &lt;- as_tibble(filelist_itc.dat) filelist_itcdata.tib &lt;- filelist_itc.tib %&gt;% dplyr::mutate(., filetype = str_extract(read, &quot;Raw|FitPars|FinalFigure|InjTab|NormalizedInjHeat&quot;)) filelistdata_itctitrations.tib &lt;- filelist_itcdata.tib %&gt;% dplyr::filter(., filetype == &quot;FinalFigure&quot;) %&gt;% dplyr::select(files,read) %&gt;% separate(., files, c(&quot;filename&quot;, &quot;filetype1&quot;, &quot;filetype2&quot;), sep = &quot;_&quot;, remove = FALSE) %&gt;% separate(., filename, c(&quot;date&quot;, &quot;cell&quot;, &quot;syringe&quot;, &quot;runid&quot;), sep =&quot;x&quot;) %&gt;% dplyr::mutate(., cell_corr = case_when((cell == &quot;RBB&quot; &amp; filetype1 == &quot;ctrl&quot;) ~ &quot;HBS&quot;, (cell == &quot;RBB&quot; &amp; filetype1 == &quot;sample&quot;) ~ &quot;RBD&quot;, TRUE ~ cell)) %&gt;% mutate(data = purrr::map(read,~read_csv(.,col_names = TRUE) )) %&gt;% dplyr::mutate(., data_mod = purrr::map(data, ~gather(.,&quot;Fit_X&quot;, &quot;Fit_Y&quot;,&quot;NDH_X&quot;,&quot;NDH_Y&quot;,key=&quot;label&quot;,value=&quot;value&quot;))) %&gt;% dplyr::mutate(., data_mod = purrr::map(data_mod, ~separate(.,label,c(&quot;type&quot;,&quot;axis&quot;), sep=&quot;_&quot;))) %&gt;% dplyr::mutate(., data_mod = purrr::map(data_mod, ~spread(.,key=&quot;axis&quot;,value=&quot;value&quot;))) %&gt;% dplyr::mutate(., data_fit = purrr::map(data, ~dplyr::select(.,Fit_X, Fit_Y, NDH_X, NDH_Y))) %&gt;% dplyr::mutate(., filename = files) %&gt;% dplyr::select(., -files) #1 kcal is 4184 J # R: 8.3145 # T (37+272) # RTlnK = dG filelistdata_itctable.tib &lt;- filelist_itcdata.tib %&gt;% dplyr::filter(., filetype == &quot;FitPars&quot;) %&gt;% mutate(data = purrr::map(read,~read_csv(.,col_names = c(&quot;filename&quot;, &quot;temp&quot;, &quot;binding&quot;, &quot;syr_conc&quot;, &quot;cell_conc&quot;, &quot;unknown&quot;, &quot;fitted&quot;, &quot;nsites&quot;, &quot;kd&quot;, &quot;dH&quot;, &quot;dG&quot;, &quot;mTdS&quot;, &quot;offset&quot;), skip = 1) )) %&gt;% mutate(data = purrr::map(data,~dplyr::select(.,filename, syr_conc, cell_conc, nsites, kd, dH, dG, mTdS, offset))) %&gt;% mutate(data = purrr::map(data,~dplyr::mutate(.,filename, syr_conc, cell_conc, nsites = as.numeric(nsites), kd = as.numeric(kd), dH = as.numeric(dH), dG = as.numeric(dG), mTdS = as.numeric(mTdS), offset = as.numeric(offset)))) %&gt;% dplyr::select(files, data) %&gt;% unnest(., data) filelistdata_titrations_forplot &lt;- filelistdata_itctitrations.tib %&gt;% dplyr::mutate(ligand_id = paste(syringe, cell_corr, sep = &quot;_&quot;)) %&gt;% dplyr::mutate(., ligand_id = as.numeric(runid)) %&gt;% dplyr::select(., -data) %&gt;% dplyr::mutate(., gglegend = paste(cell_corr, syringe, sep = &quot;_&quot;), ggid = paste(cell_corr, syringe, runid, sep = &quot;_&quot;) ) %&gt;% dplyr::mutate(data_mod = purrr::map(data_mod, ~dplyr::mutate(., DP_Y_base = DP_Y - Baseline_Y))) %&gt;% dplyr::mutate(., plotorder = case_when(syringe == &quot;NBTY1&quot; &amp; filetype1 == &quot;sample&quot; ~ &quot;id2:nbTy1&quot;, syringe == &quot;NBVH52&quot; &amp; filetype1 == &quot;sample&quot; ~ &quot;id1:NP-VHH1&quot;, syringe == &quot;NBTY1&quot; &amp; filetype1 == &quot;ctrl&quot; ~ &quot;id3:nbTy1ctrl&quot;, TRUE ~ &quot;none&quot;)) filelistictdata_raw.tib &lt;- filelist_itcdata.tib %&gt;% dplyr::filter(., filetype == &quot;Raw&quot;) %&gt;% dplyr::select(files,read) %&gt;% mutate(data = purrr::map(read,~read_csv(.), skip = 1)) %&gt;% unnest(data) %&gt;% dplyr::select(-files, -read) filelistdata_raw_longer.tib &lt;- filelistictdata_raw.tib %&gt;% pivot_longer(., cols = everything(), names_to = c(&quot;type&quot;), values_to = c(&quot;value&quot;)) %&gt;% dplyr::mutate(., filename = str_extract(type, pattern = &quot;[:digit:]{8}x(RBD|RBB|HBS)x(NBTY1|NBVH52)&quot;), XY = str_extract(type, pattern = &quot;_[XY]&quot;), controlq = str_detect(type, pattern = &quot;ctrl&quot;), sampleq = str_detect(type, pattern = &quot;[:digit:]{2}_[XY]&quot;)) %&gt;% dplyr::mutate(., XY = str_extract(XY, pattern = &quot;[XY]&quot;)) %&gt;% dplyr::mutate(., cell_corr = case_when(controlq == &quot;FALSE&quot; ~ &quot;RBD&quot;, controlq == &quot;TRUE&quot; ~ &quot;HBS&quot;, TRUE ~ &quot;none&quot;)) %&gt;% dplyr::mutate(., runid = str_extract(type, pattern = &quot;x[:digit:]{2}&quot;)) %&gt;% dplyr::mutate(., runid = as.numeric(str_extract(runid, pattern = &quot;[:digit:]{2}&quot;))) %&gt;% pivot_wider(., id_cols = c(&quot;filename&quot;,&quot;cell_corr&quot;, &quot;runid&quot;), names_from = c(&quot;XY&quot;), values_from = c(&quot;value&quot;)) %&gt;% unnest(., cols = c(&quot;X&quot;, &quot;Y&quot;)) 2.2 ITC primary plots filelistdata_titrations_forplot1 &lt;- filelistdata_titrations_forplot %&gt;% dplyr::filter(., (filetype1 == &quot;sample&quot; | filetype1 == &quot;ctrl&quot;) &amp; (syringe == &quot;NBTY1&quot; &amp; ligand_id &gt; 1 | syringe == &quot;NBVH52&quot;)) %&gt;% unnest(., cols = c(&quot;data_mod&quot;)) filelistdata_titrations_forplot1_colourscales &lt;- filelistdata_titrations_forplot1 %&gt;% dplyr::summarize(., colour_min = round(min(DP_Y), 2)-0.01, colour_max = round(max(DP_Y),2)+0.01) %&gt;% pivot_longer(., cols = contains(&quot;colour&quot;) ) %&gt;% dplyr::select(., value) %&gt;% pull() itc_ggplot &lt;- filelistdata_titrations_forplot %&gt;% dplyr::filter(., (filetype1 == &quot;sample&quot; | filetype1 == &quot;ctrl&quot;) &amp; (syringe == &quot;NBTY1&quot; &amp; ligand_id &gt; 1 | syringe == &quot;NBVH52&quot;)) %&gt;% unnest(., cols = c(&quot;data_mod&quot;)) %&gt;% dplyr::mutate(., DP_Y_absval = (DP_Y^2)^0.5) %&gt;% ggplot(aes(x = DP_X, y = DP_Y, colour = DP_Y)) + geom_line(size=0.75) + theme_light() + scale_colour_gradient2(low = &quot;red&quot;, mid = &quot;grey&quot;, high = &quot;blue&quot;, space = &quot;Lab&quot;, midpoint = 0, limits = filelistdata_titrations_forplot1_colourscales) + #scale_color_aaas() + scale_x_continuous(&quot;time: min&quot;) + scale_y_continuous(&quot;heat/inj: ucal/s&quot;) + facet_grid(plotorder + ligand_id ~ .) + theme_minimal() print(itc_ggplot) ggsave(&quot;./itc_ggplot.jpeg&quot;, device = &quot;jpeg&quot;,width = 120, height = 90, units = c(&quot;mm&quot;)) #ggsave(&quot;./itc_ggplot.ps&quot;, device = &quot;ps&quot;,width = 120, height = 90, units = c(&quot;mm&quot;)) Primary ITC data were plotted in panels, used for Figure 3C and supplemental Figure 2B in ms. 2.3 ITC binding isotherms and thermodynamic signatures itc_fit_ggplot &lt;- filelistdata_titrations_forplot %&gt;% dplyr::filter(., filetype1 == &quot;sample&quot; &amp; (syringe == &quot;NBTY1&quot; &amp; ligand_id &gt; 1 | syringe == &quot;NBVH52&quot;)) %&gt;% dplyr::select(., -data_mod) %&gt;% unnest(., c(&quot;data_fit&quot;)) %&gt;% ggplot(aes(x = Fit_X, y = Fit_Y, group = factor(filename))) + geom_line(aes(colour = plotorder), size=1) + geom_point(aes(x = NDH_X, y = NDH_Y, colour = plotorder), size=2) + scale_color_aaas() + theme_light() + scale_x_continuous(&quot;molar ratio&quot;) + scale_y_continuous(&quot;DQ: kcal/mol&quot;) #theme(legend.position=&quot;none&quot;) #facet_grid(. ~ cell_corr) print(itc_fit_ggplot) ggsave(&quot;./itc_fit_ggplot.jpeg&quot;, device = &quot;jpeg&quot;, width = 160, height = 110, units = c(&quot;mm&quot;)) #ggsave(&quot;./itc_fit_ggplot.ps&quot;, device = &quot;ps&quot;, width = 160, height = 110, units = c(&quot;mm&quot;)) Binding isotherms used for Figure 3C in ms. itc_combplot &lt;- ggpubr::ggarrange(itc_ggplot, itc_fit_ggplot, nrow = 2, ncol = 1, heights = c(1.2,0.8)) ggsave(file=&quot;itc_combplot.jpeg&quot;, plot=itc_combplot, device=&quot;jpeg&quot;, width = 80, height = 70, units = c(&quot;mm&quot;)) ggsave(file=&quot;itc_combplot.ps&quot;, plot=itc_combplot, device=&quot;ps&quot;, width = 80, height = 70, units = c(&quot;mm&quot;)) print(itc_combplot) The almost ready plot that was used for Figure 3C. 2.4 ITC raw data plots itc_raw_ggplot &lt;- filelistdata_raw_longer.tib %&gt;% dplyr::mutate(., syringe = str_extract(filename, pattern = &quot;(NBTY1|NBVH52)&quot;)) %&gt;% ggplot(aes(x = X, y = Y)) + geom_line(size=0.2) + theme_light() + scale_color_aaas() + scale_x_continuous(&quot;time: min&quot;) + scale_y_continuous(&quot;heat/inj: ucal/s&quot;) + facet_grid(syringe+runid ~ cell_corr, scale = &quot;free_y&quot;) + theme(legend.position=&quot;none&quot;) print(itc_raw_ggplot) ggsave(&quot;./itc_raw_ggplot.jpeg&quot;, device = &quot;jpeg&quot;,width = 120, height = 90, units = c(&quot;mm&quot;)) ggsave(&quot;./itc_raw_ggplot.ps&quot;, device = &quot;ps&quot;,width = 120, height = 90, units = c(&quot;mm&quot;)) Raw data that were used for the analysis and extraction of binding parameters. Not shown in ms. 2.5 estimating the error from the two experiments filelistdata_itctable_kable.tib &lt;- filelistdata_itctable.tib %&gt;% dplyr::filter(., filename == &quot;20200607xRBBxNBTY1x02&quot; | filename == &quot;20200607xRBDxNBTY1x03&quot;) %&gt;% dplyr::summarize(., dG_mean = mean(dG), dG_sd = sd(dG)) %&gt;% dplyr::mutate(dG_plus = dG_mean + dG_sd, dG_minus = dG_mean - dG_sd) %&gt;% dplyr::mutate(., KD_mean = exp(dG_mean*4184/(8.3145*(37+273)))*10^9, KD_plus = exp(dG_plus*4184/(8.3145*(37+273)))*10^9,KD_minus = exp(dG_minus*4184/(8.3145*(37+273)))*10^9 ) %&gt;% pivot_longer(., cols = everything()) %&gt;% pivot_wider(., names_from = c(&quot;name&quot;), values_from = &quot;value&quot;) %&gt;% pivot_longer(., cols = everything(), names_to = c(&quot;.value&quot;, &quot;par&quot;), names_sep = &quot;_&quot;) %&gt;% dplyr::select(., dG, KD, par) kable(filelistdata_itctable_kable.tib,digits = 1) dG KD par -11.4 9.2 mean 1.3 NA sd -10.1 72.5 plus -12.7 1.2 minus Mean and sd values of dG were calculated from the two experiments. \\(\\Delta G = -RTlnK\\) was then used to derive the lower and upper bounds for the affinity as mentioned in the ms. dG is in kcal/mol, KD in nM. Plots were saved as postscript files, and edited into publication-quality figures using Adobe Illustrator. I am not a programmer, and this is most probably not efficient code, but the code was useful for data analysis and produced some understandable and hopefully visually appealing figures. If you spot errors please drop me a message. Note that the echo = FALSE parameter was added to the code chunk to prevent printing of the R code that generated the plot. 3 References "]
]
